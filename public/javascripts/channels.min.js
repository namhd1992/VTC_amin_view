var deleted_id=0,item_name="Channel",item_names="Channels",editing_channel=null,tag_array=[],package_array=[],channel_array=[],page_datatable=null,search_value="",typingTimer,doneTypingInterval=500,is_requesting=!1,typing_input,Page_script=function(){return{init:function(){}}}(),load_page=function(){var e=function(e){tag_array.splice(tag_array.indexOf(e),1)},a=function(){function a(e){if(e.loading)return e.text;var a="<div class='select2-result-repository clearfix'><div class='select2-result-repository__avatar'><img src='"+e.owner.avatar_url+"' /></div><div class='select2-result-repository__meta'><div class='select2-result-repository__title'>"+e.full_name+"</div>";return e.description&&(a+="<div class='select2-result-repository__description'>"+e.description+"</div>"),a+="<div class='select2-result-repository__statistics'><div class='select2-result-repository__forks'><span class='glyphicon glyphicon-flash'></span> "+e.forks_count+" Forks</div><div class='select2-result-repository__stargazers'><span class='glyphicon glyphicon-star'></span> "+e.stargazers_count+" Stars</div><div class='select2-result-repository__watchers'><span class='glyphicon glyphicon-eye-open'></span> "+e.watchers_count+" Watchers</div></div></div></div>"}function t(e){return e.full_name||e.text}$.fn.select2.defaults.set("theme","bootstrap");var n="Type to search";$(".select2, .select2-multiple").select2({placeholder:n,width:null}),$(".select2-allow-clear").select2({allowClear:!0,placeholder:n,width:null}),$(".js-data-example-ajax").select2({width:"off",ajax:{url:"https://api.github.com/search/repositories",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,a){return{results:e.items}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1,templateResult:a,templateSelection:t}),$("button[data-select2-open]").click(function(){$("#"+$(this).data("select2-open")).select2("open")}),$(":checkbox").on("click",function(){$(this).parent().nextAll("select").prop("disabled",!this.checked)}),$(".select2").on("select2:open",function(){if($(this).parents("[class*='has-']").length)for(var e=$(this).parents("[class*='has-']")[0].className.split(/\s+/),a=0;a<e.length;++a)e[a].match("has-")&&$("body > .select2-container").addClass(e[a]);typing_input=$(".select2-search__field")[0],$(typing_input).on("keypress",function(){console.log("press"),clearTimeout(typingTimer),typingTimer=setTimeout(function(){_send_info.data={limit:10,offset:0,searchValue:$(typing_input).val()},$("#single_select").html(""),$.ajax({url:base_request_url+"/admin/tags",type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){console.log("success");$(e.dataArr).each(function(e,a){$("#single_select").append("<option value='"+a.id+"'> "+a.name+"</option>")})},error:function(e){console.log("error"),console.log(e.error())}})},doneTypingInterval)})}),$(".js-btn-set-scaling-classes").on("click",function(){$("#select2-multiple-input-sm, #select2-single-input-sm").next(".select2-container--bootstrap").addClass("input-sm"),$("#select2-multiple-input-lg, #select2-single-input-lg").next(".select2-container--bootstrap").addClass("input-lg"),$(this).removeClass("btn-primary btn-outline").prop("disabled",!0)}),$("#single_select").change(function(){$.inArray($("#single_select").val(),tag_array)==-1&&(tag_array.push($("#single_select").val()),$(".current_tags").append(" <span tag_id='"+$("#single_select").val()+"' class='tag label label-info'><i class='fa fa-tags'></i> "+$("#single_select option:selected").text()+"<span class='remove_tag' data-role='remove'></span></span>"),$(".current_tags .remove_tag").click(function(){e($(this).parent().attr("tag_id")),$(this).parent().remove()}))})};$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"}),_send_info.data={limit:10,offset:0},$.ajax({url:base_request_url+"/admin/tags",type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$(e.dataArr).each(function(e,a){$("#single_select").append("<option value='"+a.id+"'> "+a.name+"</option>")}),a()},error:function(e){console.log("error"),console.log(e.error())}}),_send_info.data={},page_datatable=$("#page_datatable").DataTable({ajax:{url:base_request_url+"/admin/channel",type:"GET",data:function(){var e={};return e.limit=_per_page,e.offset=_per_page*(_current_page-1),null!=search_value&&(e.searchValue=search_value),e},contentType:"application/json",dataType:"json",dataSrc:function(e){var a=0;if($(".datatable_paging").html(""),e.totalRecords>_per_page)for(a=1;a<=Math.ceil(e.totalRecords/_per_page);a++)a==_current_page?$(".datatable_paging").append("<span class='datatable_paging_number_active' page="+a+">"+a+"</span>"):1!=a&&a!=Math.ceil(e.totalRecords/_per_page)&&a!=_current_page-1&&a!=_current_page-2&&a!=_current_page+2&&a!=_current_page+1||(1==a&&_current_page>4?($(".datatable_paging").append("<span class='datatable_paging_number' page="+a+">"+a+"</span>"),$($(".datatable_paging_number")[0]).after("<span class='paging_truncate'>...</span>")):a==Math.ceil(e.totalRecords/_per_page)&&_current_page<Math.ceil(e.totalRecords/_per_page)-3?($(".datatable_paging").append("<span class='datatable_paging_number' page="+a+">"+a+"</span>"),$($(".datatable_paging_number")[$(".datatable_paging_number").length-1]).before("<span class='paging_truncate'>...</span>")):$(".datatable_paging").append("<span class='datatable_paging_number' page="+a+">"+a+"</span>"));else $(".datatable_paging").html("<span class='datatable_paging_number_active' page=1>1</span>");return $(".datatable_paging_number").click(function(e){$(".loading_icon").show(),_current_page=parseInt($(e.target).attr("page")),page_datatable.ajax.reload()}),$(".loading_icon").hide(),null!=e.dataArr?e.dataArr:[]},beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},error:function(e,a,t){"invalid_token"==JSON.parse(e.responseText).error&&(localStorage.removeItem("user_data"),document.location.replace("login"))}},columns:[{title:"ID",data:"id"},{title:"Name",data:"name"},{title:"Followers",data:"numberFollower"},{title:"News",data:"numberNews"},{title:"Tags",data:null,render:function(e,a,t,n){var s=0;return $(t.tagsList).each(function(e,a){null===a.tagType&&(s+=1)}),"<i class='fa fa-tags'></i> "+s}},{title:"Status",data:null,render:function(e,a,t,n){var s=null;return"active"==t.status?s="<div class='active_status' >"+t.status+"</div>":"inactive"==t.status&&(s="<div class='inactive_status' >"+t.status+"</div>"),s}},{title:"Actions",data:null,render:function(e,a,t,n){var s="";return s="<a class='btn_edit_item' item_id='"+t.id+"' item_obj='"+JSON.stringify(t)+"' ><i class='icon-wrench'></i> Edit </a>",s+="<a class='btn_delete_item' item_id='"+t.id+"' item_obj='"+JSON.stringify(t)+"' ><i class='icon-trash'></i> Delete </a>"}}],aoColumnDefs:[{sWidth:"5%",aTargets:[0]},{sWidth:"30%",aTargets:[1]},{sWidth:"10%",aTargets:[2]},{sWidth:"10%",aTargets:[3]},{sWidth:"5%",aTargets:[4]},{sWidth:"10%",aTargets:[5]},{sWidth:"20%",aTargets:[6]}],autoWidth:!1,searching:!1,lengthChange:!1,bPaginate:!1,info:!1,bSort:!1,filter:!1,fnDrawCallback:function(a){$(".btn_edit_item").click(function(){tag_array=[],package_array=[];var a=JSON.parse($(this).attr("item_obj"));editing_channel=a.id,$("#modal_add_edit .modal-title").html("Edit "+item_name+" "+a.name),$("#modal_add_edit .txt_add_edit_channel_name").val(a.name),$("#modal_add_edit .txt_add_edit_channel_image").val(a.defaultImage),$("#modal_add_edit .btn_modal_save").html("Publish change"),$(".current_tags").html(" "),$(".current_packages").html(" "),$.each(a.tagsList,function(e,a){null===a.tagType?($(".current_tags").append(" <span class='tag label label-info'><i class='fa fa-tags'></i> "+a.name+"<span class='remove_tag' data-role='remove'></span></span>"),tag_array.push(a.id)):"game"==a.tagType&&($(".current_packages").append(" <span class='tag label label-warning'><i class='fa fa-gamepad'></i> "+a.name+"</span>"),package_array.push(a.id))}),$(".current_tags .remove_tag").click(function(){e($(this).parent().attr("tag_id")),$(this).parent().remove()}),$(".current_packages .remove_package").click(function(){remove_package($(this).parent().attr("package_id")),$(this).parent().remove()}),$("#modal_add_edit .btn_modal_save_update").attr("item_id",$(this).attr("item_id")),$(".btn_delete_item").attr("item_id",$(this).attr("item_id")),$(".btn_delete_item").show(),$("#modal_add_edit .btn_modal_save_new").hide(),$("#modal_add_edit .btn_modal_save_update").show(),jQuery(".select_status option").filter(function(){return $.trim($(this).val())==a.status}).prop("selected",!0),$(".select_status").selectpicker("refresh"),"active"==a.status?$(".select_status button").css("background-color","#32c5d2"):$(".select_status button").css("background-color","red"),$("#modal_add_edit").modal("show")}),$(".btn_delete_item").click(function(){deleted_id=parseInt($(this).attr("item_id")),$("#modal_confirm").modal("show")})}}),$(".btn_confirm_yes").click(function(){_send_info.data={channelIds:[deleted_id]},$.ajax({url:base_request_url+"/admin/channel",type:"DELETE",data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(){$("#modal_confirm").modal("hide"),_send_info.data={},page_datatable.ajax.reload(),$("#modal_add_edit").modal("hide"),show_toast_notif("success","Successfully","Deleted: '"+$(".txt_add_edit_channel_name").val()+"'",function(){})},error:function(e){show_toast_notif("error","Error","'"+e.responseText+"'",function(){})}})}),$(".search_submit").click(function(){search_value=$(".search_input").val(),page_datatable.ajax.reload(null,!1)}),$(".search_clear").click(function(){search_value="",$(".search_input").val(""),page_datatable.ajax.reload(null,!1)}),$(".btn_modal_save_new").click(function(){_send_info.data={name:$(".txt_add_edit_channel_name").val(),status:$(".select_status option:selected").val(),description:"no description",defaultImage:$(".txt_add_edit_channel_image").val(),listTags:$.merge(tag_array,package_array)},$.ajax({url:base_request_url+"/admin/channel",type:"POST",data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$("#modal_add_edit").modal("hide"),_send_info.data={},page_datatable.ajax.reload(null,!1),"T"==e.statusCode?show_toast_notif("success","Successfully","Created: '"+$(".txt_add_edit_channel_name").val()+"'",function(){}):show_toast_notif("error","Error","'"+e.onlyMessage+"'",function(){})},error:function(e){show_toast_notif("error","Error","'"+e.responseText+"'",function(){})}})}),$(".btn_modal_save_update").click(function(){_send_info.data={id:$(this).attr("item_id"),name:$(".txt_add_edit_channel_name").val(),status:$(".select_status option:selected").val(),description:"no description",defaultImage:$(".txt_add_edit_channel_image").val(),listTags:$.merge(tag_array,package_array)},$.ajax({url:base_request_url+"/admin/channel",type:"PUT",data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(){$("#modal_add_edit").modal("hide"),_send_info.data={},page_datatable.ajax.reload(null,!1),show_toast_notif("success","Successfully","Updated '"+$(".txt_add_edit_channel_name").val()+"'",function(){})},error:function(e){$("#modal_add_edit").modal("hide"),show_toast_notif("error","Error","'"+e.responseText+"'",function(){})}})}),$(".btn_add_new_item").click(function(){tag_array=[],$("#modal_add_edit .modal-title").html("Create new "+item_name),$("#modal_add_edit .txt_add_edit_channel_name").val(""),$("#modal_add_edit .txt_add_edit_channel_image").val(""),$("#modal_add_edit .btn_modal_save_new").show(),$("#modal_add_edit .btn_modal_save_update").hide(),$(".current_tags").html(" "),$(".current_packages").html(" "),$("#modal_add_edit").modal("show")}),$(".btn_update_position").click(function(){$(".loading_icon").show(),_send_info.data={limit:1e5,offset:0},$.ajax({url:base_request_url+"/admin/channel",type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$("#items").html(""),$(e.dataArr).each(function(e,a){$("#items").append("<li item_id="+a.id+" class='list channel_position'>"+a.name+"</li>")}),$("#items").sortable({placeholder:"highlight",start:function(e,a){a.item.toggleClass("highlight")},stop:function(e,a){a.item.toggleClass("highlight")}}),$("#items").disableSelection(),$("#modal_update_position").modal("show"),$(".loading_icon").hide()},error:function(e){console.log("error"),console.log(e.error()),$(".loading_icon").hide()}})}),$(".select_status").change(function(){"active"==$(this).val()?$(".select_status button").css("background-color","#32c5d2"):"inactive"==$(this).val()&&$(".select_status button").css("background-color","red")}),$(".btn_modal_save_position").click(function(){$(".loading_icon").show();var e={},a=1;$(".channel_position").each(function(t,n){e[$(n).attr("item_id")]=a,a++}),$.ajax({url:base_request_url+"/admin/channelPosition",type:"POST",data:JSON.stringify(e),contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){_send_info.data={},page_datatable.ajax.reload(null,!1),"T"==e.statusCode?show_toast_notif("success","Successfully","Positions are updated",function(){}):show_toast_notif("error","Error","'"+e.onlyMessage+"'",function(){}),$("#modal_update_position").modal("hide"),$(".loading_icon").hide()},error:function(e){show_toast_notif("error","Error","'"+e.responseText+"'",function(){}),$(".loading_icon").hide()}})})};jQuery(document).ready(function(){Page_script.init(),load_page()});