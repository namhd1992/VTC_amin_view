function str_pad(e){return String("00"+e).slice(-2)}var editing_item=null,search_value=null,game_raking=null,page_datatable=null,deleted_obj=null,deleted_id=null;_current_page=1;var imageLogo=null,linkImage=null,Page_script={init:function(){}};_send_info.data={limit:1e3,offset:0};var load_page=function(){function e(e){_send_info.data={id:editing_item,gameRankingId:game_ranking_id,rankName:$(".txt_add_edit_item_name").val(),rankPosition:$(".txt_add_edit_item_position").val(),rankIconUrl:$(".txt_add_edit_item_link_logo").text(),rankQuantity:$(".txt_add_edit_item_quantity").val(),description:$(".txt_add_edit_item_description").val(),status:$(".select_status option:selected").val()};var a="";switch(e){case"CREATE":editing_item=null,a="POST";break;case"UPDATE":a="PUT"}$(".loading_icon").show(),$.ajax({url:base_request_url+"/admin/game-ranking-rank",type:a,data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){page_datatable.ajax.reload(null,!1),"01"==e.status?(show_toast_notif("success","Successfully","Updated '"+$(".txt_add_edit_item_name").val()+"'",function(){}),$("#modal_add_edit").modal("hide")):show_toast_notif("error","Fail",e.message,function(){}),$(".loading_icon").hide()},error:function(e){console.log(_send_info.data),show_toast_notif("error","Fail","Error '"+e.responseText+"'",function(){}),$(".loading_icon").hide()}})}function a(e){if(flagNewImage&&null!=e&&null!=e){var a=new FormData;a.append("image",e),$(".loading_icon").show(),$.ajax({url:base_request_url+"/admin/uploadImage",type:"POST",data:a,cache:!1,async:!1,contentType:!1,timeout:3e6,processData:!1,beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){"01"==e.status?(linkImage=e.data,t($("#modal_add_edit .txt_add_edit_item_link_logo").html()),$(".loading_icon").hide(),show_toast_notif("success","Successfully","Add new image success")):($(".loading_icon").hide(),show_toast_notif("error","Fail","Upload Image Unsuccess"))},error:function(e){show_toast_notif("error","Fail","Error '"+e.message+"'"),$(".loading_icon").hide()}})}}function t(e){flagNewImage&&(_send_info.data={urlImage:e},$.ajax({url:base_request_url+"/admin/deleteImage",type:"POST",data:JSON.stringify(_send_info.data),cache:!1,async:!1,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){page_datatable.ajax.reload(null,!1),"01"==e.status?(flagNewImage=!1,$(".loading_icon").hide(),show_toast_notif("success","Successfully","Add new and Delete old image success")):(show_toast_notif("error","Fail","Delete Image Unsuccess"),$(".loading_icon").hide())},error:function(e){show_toast_notif("error","Fail","Error '"+e.message+"'"),$(".loading_icon").hide()}}))}_send_info.data={limit:_per_page,offset:_per_page*(_current_page-1)},$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"}),page_datatable=$("#page_datatable").DataTable({ajax:{url:base_request_url+"/admin/game-ranking-rank?game_ranking_id="+game_ranking_id,type:"GET",data:function(e){null!=search_value&&""!=search_value&&(e.searchValue=search_value),e.limit=_per_page,e.offset=_per_page*(_current_page-1)},contentType:"application/json",dataType:"json",dataSrc:function(e){console.log(e);var a=0;if($(".datatable_paging").html(""),e.totalRecords>_per_page)for(a=1;a<=Math.ceil(e.totalRecords/_per_page);a++)a==_current_page?$(".datatable_paging").append("<span class='datatable_paging_number_active' page="+a+">"+a+"</span>"):1!=a&&a!=Math.ceil(e.totalRecords/_per_page)&&a!=_current_page-1&&a!=_current_page-2&&a!=_current_page+2&&a!=_current_page+1||(1==a&&_current_page>4?($(".datatable_paging").append("<span class='datatable_paging_number' page="+a+">"+a+"</span>"),$($(".datatable_paging_number")[0]).after("<span class='paging_truncate'>...</span>")):a==Math.ceil(e.totalRecords/_per_page)&&_current_page<Math.ceil(e.totalRecords/_per_page)-3?($(".datatable_paging").append("<span class='datatable_paging_number' page="+a+">"+a+"</span>"),$($(".datatable_paging_number")[$(".datatable_paging_number").length-1]).before("<span class='paging_truncate'>...</span>")):$(".datatable_paging").append("<span class='datatable_paging_number' page="+a+">"+a+"</span>"));else $(".datatable_paging").html("<span class='datatable_paging_number_active' page=1>1</span>");return $(".datatable_paging_number").click(function(e){_current_page=parseInt($(e.target).attr("page")),page_datatable.ajax.reload()}),null!=e.data?e.data:[]},beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},error:function(e,a,t){"invalid_token"==JSON.parse(e.responseText).error&&(localStorage.removeItem("user_data"),document.location.replace("login"))}},responsive:!1,columns:[{title:"ID",data:"id"},{title:"Icon",data:null,render:function(e,a,t,n){var i="";return i+="<img src='"+t.rankIconUrl+"' style='height: 40px;width: 40px'>",i}},{title:"Rank Name",data:"rankName"},{title:"Thứ Hạng",data:"rankPosition"},{title:"Số Lượng Rank",data:"rankQuantity"},{title:"Create On",data:null,render:function(e,a,t,n){var i=moment(t.createOn).format("YYYY-MMMM-D HH:mm");return i}},{title:"Action",data:null,render:function(e,a,t,n){var i="";return i+="<a class='btn_edit_item' item_id='"+t.id+"' item_obj='"+JSON.stringify(t)+"'><i class='icon-wrench'></i> Edit </a>",i+="<a class='btn_delete_item' item_id='"+t.id+"' item_obj='"+JSON.stringify(t)+"'><i class='icon-trash'></i> Delete </a>",i+="<a class='btn_edit_item' href='/game_ranking_item?rank_id="+t.id+"&game_ranking_id="+game_ranking_id+"'><i class='icon-wrench'></i> Quản Lý Phúc Lợi </a>",i}}],aoColumnDefs:[{responsivePriority:1,sWidth:"3%",aTargets:[0]},{responsivePriority:2,sWidth:"5%",aTargets:[1]},{responsivePriority:3,sWidth:"25%",aTargets:[2]},{responsivePriority:4,sWidth:"12%",aTargets:[3]},{responsivePriority:5,sWidth:"10%",aTargets:[4]},{responsivePriority:6,sWidth:"20%",aTargets:[5]},{responsivePriority:7,sWidth:"25%",aTargets:[6]}],autoWidth:!0,lengthChange:!0,info:!1,bSort:!0,bFilter:!1,bPaginate:!1,fnDrawCallback:function(e){$(".btn_edit_item").click(function(){var e=JSON.parse($(this).attr("item_obj"));editing_item=e.id,$(".txt_add_edit_item_name").val(e.rankName),$("#modal_add_edit .txt_add_edit_item_link_logo").text(""),$("#modal_add_edit .logo_img").css("background-image","url("+e.rankIconUrl+")"),$("#modal_add_edit .txt_add_edit_item_link_logo").text(e.rankIconUrl),$(".txt_add_edit_item_position").val(e.rankPosition),$(".txt_add_edit_item_quantity").val(e.rankQuantity),$("#modal_add_edit .btn_modal_save_new").hide(),$("#modal_add_edit .btn_modal_save_update").show(),$("#modal_add_edit").modal("show"),$(".item_clone").remove(),null!=e.gameRankingItems&&($.each(e.gameRankingItems,function(e,a){$(".item_detail").children(".item_name").html("");var t=$(".item_detail").clone();t.removeClass("item_detail"),t.addClass("item_clone"),t.children(".item_name").html(a.itemName),t.children(".item_type").html(a.itemType),t.children(".item_quantity").html(a.itemQuantity),$(".item_group").append(t)}),$(".item_detail").hide(),$(".item_clone").show()),$(".btn_rank_manager").attr("href","/game_ranking_item?rank_id="+e.id+"&game_ranking_id="+game_ranking_id)}),$(".btn_delete_item").click(function(){var e=JSON.parse($(this).attr("item_obj"));deleted_obj=e,deleted_id=e.id,$("#modal_confirm").modal("show")})}}),$(".txt_add_edit_item_file_logo").change(function(){var e=this.files[0];(e="image/jpeg"==e.type||"image/png"==e.type||"image/jpg"==e.type||"image/gif"==e.type)?(imageLogo=this.files[0],$("#modal_add_edit .txt_add_edit_item_image_logo").css("background-image","url("+URL.createObjectURL(imageLogo)+")"),flagNewImage=!0,$(".txt_add_edit_item_file_logo").val("")):(show_toast_notif("error","Error","Không Đúng Định Dạng Ảnh",function(){}),imageLogo=null)}),$(".btn_modal_upload_image_logo").click(function(){a(imageLogo),null==linkImage?show_toast_notif("error","Lỗi Tải Ảnh","Chưa chọn ảnh",function(){}):($("#modal_add_edit .txt_add_edit_item_link_logo").html(linkImage),linkImage=null)}),$(".select_status").change(function(){""!=$(this).val()&&("active"==$(this).val()?$(".select_status button").css("background-color","#32c5d2"):"inactive"==$(this).val()&&$(".select_status button").css("background-color","red"),$(".hidden_item_status").val($(this).val()))}),$(".btn_add_new_item").click(function(){$("#add_edit_game_ranking_form").trigger("reset"),$(".item_clone").remove(),$("#modal_add_edit .btn_modal_save_new").show(),$("#modal_add_edit .btn_modal_save_update").hide(),$("#modal_add_edit").modal("show"),$("#modal_add_edit .btn_modal_save_new").click(function(){e("CREATE")})}),$("#modal_add_edit .btn_modal_save_update").click(function(){e("UPDATE")}),$(".btn_confirm_yes").click(function(){$.ajax({url:base_request_url+"/admin/game-ranking-rank?id="+deleted_id,type:"DELETE",contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(){$("#modal_confirm").modal("hide"),_send_info.data={},page_datatable.ajax.reload(),$("#modal_add_edit").modal("hide"),show_toast_notif("success","Successfully","Deleted: '"+deleted_obj.name+"'",function(){})},error:function(e){show_toast_notif("error","Error","'"+e.responseText+"'",function(){})}})}),$("#single_select_game").change(function(){var e=$("#single_select_game").val();0!=e?$(".txt_add_edit_service_id").attr("disabled","disable"):$(".txt_add_edit_service_id").removeAttr("disabled"),console.log(e),$(".txt_add_edit_service_id").val(e)}),$.ajax({url:base_request_url+"/admin/game-ranking/"+game_ranking_id,type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){game_raking=e.data,$(".ranking_name").text(game_raking.name)},error:function(e){console.log(e.error())}})};jQuery(document).ready(function(){Page_script.init(),load_page()});