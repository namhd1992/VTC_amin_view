var _current_page=1;_per_page=5;var search_value="",search_start="",search_end="",search_report_type=1;$(document).ready(function(){function e(e){$("body").excelexportjs({datatype:"json",dataset:e,columns:getColumns(e)})}var t=function(){$("#defaultrange").daterangepicker({opens:App.isRTL()?"left":"right",format:"YYYY-MMMM-D HH:mm",separator:" to ",startDate:moment().subtract("days",29),endDate:moment(),time:{enabled:!0},ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract("days",1),moment().subtract("days",1)],"Last 7 Days":[moment().subtract("days",6),moment()],"Last 30 Days":[moment().subtract("days",29),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract("month",1).startOf("month"),moment().subtract("month",1).endOf("month")]}},function(e,t){$("#defaultrange input").val(e.format("YYYY-MMMM-D HH:mm")+" - "+t.format("YYYY-MMMM-D HH:mm")),search_start=e,search_end=t});var e=function(){function e(e){if(e.loading)return e.text;var t="<div class='select2-result-repository clearfix'><div class='select2-result-repository__avatar'><img src='"+e.owner.avatar_url+"' /></div><div class='select2-result-repository__meta'><div class='select2-result-repository__title'>"+e.full_name+"</div>";return e.description&&(t+="<div class='select2-result-repository__description'>"+e.description+"</div>"),t+="<div class='select2-result-repository__statistics'><div class='select2-result-repository__forks'><span class='glyphicon glyphicon-flash'></span> "+e.forks_count+" Forks</div><div class='select2-result-repository__stargazers'><span class='glyphicon glyphicon-star'></span> "+e.stargazers_count+" Stars</div><div class='select2-result-repository__watchers'><span class='glyphicon glyphicon-eye-open'></span> "+e.watchers_count+" Watchers</div></div></div></div>"}function t(e){return e.full_name||e.text}$.fn.select2.defaults.set("theme","bootstrap");var a="Type to search";$(".select2, .select2-multiple").select2({placeholder:a,width:null}),$(".select2-allow-clear").select2({allowClear:!0,placeholder:a,width:null}),$(".js-data-example-ajax").select2({width:"off",ajax:{url:"https://api.github.com/search/repositories",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){return{results:e.items}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1,templateResult:e,templateSelection:t}),$("button[data-select2-open]").click(function(){$("#"+$(this).data("select2-open")).select2("open")}),$(":checkbox").on("click",function(){$(this).parent().nextAll("select").prop("disabled",!this.checked)}),$(".js-btn-set-scaling-classes").on("click",function(){$("#select2-multiple-input-sm, #select2-single-input-sm").next(".select2-container--bootstrap").addClass("input-sm"),$("#select2-multiple-input-lg, #select2-single-input-lg").next(".select2-container--bootstrap").addClass("input-lg"),$(this).removeClass("btn-primary btn-outline").prop("disabled",!0)})};e(),$(".loading_icon").show(),page_datatable=$("#page_datatable").DataTable({ajax:{url:base_request_url+"/admin/reportPublisher",type:"GET",data:function(e){return""!=search_report_type?e.reportType=search_report_type:e.reportType=1,""!=search_value&&(e.searchValue=search_value),""!=search_start&&(e.fromDate=search_start),""!=search_end&&(e.toDate=search_end),e.limit=_per_page,e.offset=_per_page*(_current_page-1),e},contentType:"application/json",dataType:"json",dataSrc:function(e){var t=0;if($(".datatable_paging").html(""),e.totalRecords>_per_page)for(t=1;t<=Math.ceil(e.totalRecords/_per_page);t++)t==_current_page?$(".datatable_paging").append("<span class='datatable_paging_number_active' page="+t+">"+t+"</span>"):1!=t&&t!=Math.ceil(e.totalRecords/_per_page)&&t!=_current_page-1&&t!=_current_page-2&&t!=_current_page+2&&t!=_current_page+1||(1==t&&_current_page>4?($(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"),$($(".datatable_paging_number")[0]).after("<span class='paging_truncate'>...</span>")):t==Math.ceil(e.totalRecords/_per_page)&&_current_page<Math.ceil(e.totalRecords/_per_page)-3?($(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"),$($(".datatable_paging_number")[$(".datatable_paging_number").length-1]).before("<span class='paging_truncate'>...</span>")):$(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"));else $(".datatable_paging").html("<span class='datatable_paging_number_active' page=1>1</span>");return $(".datatable_paging_number").click(function(e){$(".loading_icon_inside").show(),_current_page=parseInt($(e.target).attr("page")),page_datatable.ajax.reload()}),$(".loading_icon").hide(),$(".loading_icon_inside").hide(),null!=e.dataArr?(console.log(e),$(".widget_total").attr("data-value",e.dataObj.totalGiftcode),$(".widget_share").attr("data-value",e.dataObj.totalShare),$(".widget_delivered").attr("data-value",e.dataObj.totalGiftcodeLost),$(".widget_user").attr("data-value",e.dataObj.totalInstall),$(".widget_nru").attr("data-value",e.dataObj.totalNRU),$(".widget_info").counterUp(),e.dataArr):[]},beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},error:function(e,t,a){"invalid_token"==JSON.parse(e.responseText).error&&(localStorage.removeItem("user_data"),document.location.replace("login"))}},columns:[{title:"",data:null,render:function(e,t,a,r){var o="",n=a.nowReport.giftcodeEventId,s=a.nowReport.giftcodeEventName,l=["Install","Share FB","Ph√°t","NRU"],i=[a.nowReport.numberInstall,a.nowReport.numberShareFacebook,a.nowReport.numberGiftcodeLost,a.nowReport.numberNRU],c=[a.lastReport.numberInstall,a.lastReport.numberShareFacebook,a.lastReport.numberGiftcodeLost,a.lastReport.numberNRU],p=["record_install","record_share","record_giftcode_lost","record_nru"];3==search_report_type?(n=a.nowReport.giftcodeEventId,s=a.nowReport.giftcodeEventName,l=["Install","Share FB","Delivered","NRU"],i=[a.nowReport.numberInstall,a.nowReport.numberShareFacebook,a.nowReport.numberGiftcodeLost,a.nowReport.numberNRU],c=[a.lastReport.numberInstall,a.lastReport.numberShareFacebook,a.lastReport.numberGiftcodeLost,a.lastReport.numberNRU],p=["record_install","record_share","record_giftcode_lost","record_nru"]):2==search_report_type&&(n=a.nowReport.luckySpinId,s=a.nowReport.luckySpinName,l=["Buy turn","Profit","User play"],i=[a.nowReport.totalAmountBuyTurn,a.nowReport.totalAmountProfit,a.nowReport.totalPersonPlay],c=[a.lastReport.totalAmountBuyTurn,a.lastReport.totalAmountProfit,a.lastReport.totalPersonPlay],p=["record_buy_turn","record_profit","record_user"]),o+="<div class='record_wrap'><a href='/dashboard_p_detail?id="+n+"'><div class='record_title'><div>"+s+"</div><div class='event_id'>ID: "+n+"</div></div>";for(var d=0;d<l.length;d++)o+=i[d]>=c[d]?"<div class='"+p[d]+" record_number'><div class='column_number'>"+i[d]+"</div><div class='change_info'> <i class='fa fa-arrow-up'></i> "+Math.abs(i[d]-c[d])+" </div><div class='column_name'>"+l[d]+"</div></div>":"<div class='"+p[d]+" record_number'><div class='column_number'>"+i[d]+"</div><div class='change_info_red'> <i class='fa fa-arrow-down'></i> "+Math.abs(i[d]-c[d])+" </div><div class='column_name'>"+l[d]+"</div></div>";return o+="</a></div>"}}],aoColumnDefs:[{sWidth:"100%",aTargets:[0]}],autoWidth:!1,lengthChange:!1,info:!1,bSort:!1,bFilter:!1,bPaginate:!1,fnDrawCallback:function(e){$("div.dataTables_wrapper div.dataTables_filter label").contents().filter(function(){return 1!=this.nodeType}).replaceWith("")}})};t(),$(".search_submit").click(function(){$(".loading_icon_inside").show(),search_value=$(".search_input").val(),search_start=search_start.valueOf(),search_end=search_end.valueOf(),page_datatable.ajax.reload()}),$(".tab_button").click(function(){$(".loading_icon_inside").show(),search_report_type=$(this).attr("value"),page_datatable.ajax.reload()}),$(".export_button").click(function(){$(".loading_icon").show(),$.ajax({url:base_request_url+"/admin/reportPublisher",type:"GET",data:function(e){return""!=search_report_type?e.reportType=search_report_type:e.reportType=1,""!=search_value&&(e.searchValue=search_value),""!=search_start&&(e.fromDate=search_start),""!=search_end&&(e.toDate=search_end),e.limit=1e5,e.offset=0,e},contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(t){console.log(t);var a=[],r="";1==search_report_type?r="Giftcode ":2==search_report_type&&(r="Luckyspin "),$.each(t.dataArr,function(e,t){var r=getSetting(_setting_data,"date_format"),o=moment.unix(t.nowReport.onDate/1e3).format(r.value);1==search_report_type?a.push({ID:t.nowReport.giftcodeEventId,Name:t.nowReport.giftcodeEventName,Install:t.nowReport.numberInstall,"Share FB":t.nowReport.numberShareFacebook,Delivered:t.nowReport.numberGiftcodeLost,NRU:t.nowReport.numberNRU,Time:o}):2==search_report_type&&a.push({ID:t.nowReport.luckySpinId,Name:t.nowReport.luckySpinName,"Buy turn":t.nowReport.totalAmountBuyTurn,Profit:t.nowReport.totalAmountProfit,"User play":t.nowReport.totalPersonPlay,Time:o})}),e(a),$(".loading_icon").hide()},error:function(e){show_toast_notif("error","Fail","Error '"+e.responseText+"'"),$(".loading_icon").hide()}})})});