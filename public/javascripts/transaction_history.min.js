var editing_item=null,item_name="Deposit History",item_names="Users",deleted_id=null,channel_arr=[],page_datatable=null,search_value=null,start_time=null,end_time=null,from_amount=null,to_amount=null,sender=null,receiver=null,doneTypingInterval=500,searching_value_timeout="",typingTimer,order_by=null;_current_page=1;var Page_script=function(){return{init:function(){}}}(),str_pad=function(e){return String("00"+e).slice(-2)},reload_widget=function(){var e={};if(e.filterBy={serviceType:"transfer"},e.filterBy.createOn={},e.filterBy.amount={},e.limit=_per_page,e.offset=_per_page*(_current_page-1),null!=search_value&&(e.searchValue=search_value),null!=start_time&&""!=start_time&&(e.filterBy.createOn.fromDate=new Date(start_time).getTime()),null!=end_time&&""!=end_time&&(e.filterBy.createOn.toDate=new Date(end_time).getTime()+864e5),e.filterBy.createOn=={}&&(e.filterBy.createOn=null),null!=from_amount&&""!=from_amount&&(e.filterBy.amount.fromAmount=from_amount),null!=to_amount&&""!=to_amount&&(e.filterBy.amount.toAmount=to_amount),e.filterBy.amount=={}&&(e.filterBy.amount=null),null!=sender&&(e.filterBy.senderId=sender),null!=receiver&&(e.filterBy.receiverId=receiver),null!=order_by&&""!=order_by){var t=JSON.parse(order_by);t=={}&&(t=null),e.sortBy=t}$.ajax({url:base_request_url+"/admin/sumTransactionHistory",type:"POST",data:JSON.stringify(e),contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$(".widget_total_amount").attr("data-value",e.data.amount.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"1,")),$(".widget_total_fee").attr("data-value",e.data.fee.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"1,")),$(".widget_total_final_amount").attr("data-value",e.data.totalAmount.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"1,")),$(".widget_total_times").attr("data-value",e.data.times),$(".widget_total_amount").counterUp(),$(".widget_total_fee").counterUp(),$(".widget_total_final_amount").counterUp(),$(".widget_total_times").counterUp()},error:function(e){console.log("error"),console.log(e.error())}})},load_autocomplete_component=function(){$.fn.select2.defaults.set("theme","bootstrap");var e="Type to search";$(".select2").select2({placeholder:e,width:null}),$("button[data-select2-open]").click(function(){$("#"+$(this).data("select2-open")).select2("open")}),$(".js-btn-set-scaling-classes").on("click",function(){$("#select2-multiple-input-sm, #select2-single-input-sm").next(".select2-container--bootstrap").addClass("input-sm"),$("#select2-multiple-input-lg, #select2-single-input-lg").next(".select2-container--bootstrap").addClass("input-lg"),$(this).removeClass("btn-primary btn-outline").prop("disabled",!0)})},load_page=function(){$(".loading_icon").show(),_send_info.data={limit:_per_page,offset:0},$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"}),reload_widget(),page_datatable=$("#page_datatable").DataTable({ajax:{url:base_request_url+"/admin/getTransactionHistory",type:"POST",data:function(e){if(e.filterBy={serviceType:"transfer"},e.filterBy.createOn={},e.filterBy.amount={},e.limit=_per_page,e.offset=_per_page*(_current_page-1),null!=search_value&&(e.searchValue=search_value),null!=start_time&&""!=start_time&&(e.filterBy.createOn.fromDate=new Date(start_time).getTime()),null!=end_time&&""!=end_time&&(e.filterBy.createOn.toDate=new Date(end_time).getTime()+864e5),e.filterBy.createOn=={}&&(e.filterBy.createOn=null),null!=from_amount&&""!=start_time&&(e.filterBy.amount.fromAmount=from_amount),null!=to_amount&&""!=to_amount&&(e.filterBy.amount.toAmount=to_amount),e.filterBy.amount=={}&&(e.filterBy.amount=null),null!=sender&&(e.filterBy.senderId=sender),null!=receiver&&(e.filterBy.receiverId=receiver),null!=order_by&&""!=order_by){var t=JSON.parse(order_by);t=={}&&(t=null),e.sortBy=t}return JSON.stringify(e)},contentType:"application/json",dataType:"json",dataSrc:function(e){console.log(e);var t=0;if($(".datatable_paging").html(""),e.totalRecords>_per_page)for(t=1;t<=Math.ceil(e.totalRecords/_per_page);t++)t==_current_page?$(".datatable_paging").append("<span class='datatable_paging_number_active' page="+t+">"+t+"</span>"):1!=t&&t!=Math.ceil(e.totalRecords/_per_page)&&t!=_current_page-1&&t!=_current_page-2&&t!=_current_page+2&&t!=_current_page+1||(1==t&&_current_page>4?($(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"),$($(".datatable_paging_number")[0]).after("<span class='paging_truncate'>...</span>")):t==Math.ceil(e.totalRecords/_per_page)&&_current_page<Math.ceil(e.totalRecords/_per_page)-3?($(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"),$($(".datatable_paging_number")[$(".datatable_paging_number").length-1]).before("<span class='paging_truncate'>...</span>")):$(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"));else $(".datatable_paging").html("<span class='datatable_paging_number_active' page=1>1</span>");return $(".datatable_paging_number").click(function(e){_current_page=parseInt($(e.target).attr("page")),page_datatable.ajax.reload()}),$(".loading_icon").hide(),e.dataArr},beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},error:function(e,t,a){"invalid_token"==JSON.parse(e.responseText).error&&(localStorage.removeItem("user_data"),document.location.replace("login"))}},columns:[{title:"ID",data:"id"},{title:"Sender",data:"sender.username"},{title:"Receiver",data:"receiver.username"},{title:"Amount",data:"amount"},{title:"Fee",data:"fee"},{title:"Total Amount",data:"totalAmount"},{title:"Date",data:null,render:function(e,t,a,n){var r=getSetting(_setting_data,"date_format"),l=moment.unix(a.createOn/1e3).format(r.value);return l}},{title:"Actions",data:null,render:function(e,t,a,n){var r="";return r="<a class='btn_edit_item' item_id='"+a.id+"' item_obj='"+JSON.stringify(a)+"' ><i class='icon-question'></i> Info </a>"}}],aoColumnDefs:[{sWidth:"5%",aTargets:[0]},{sWidth:"10%",aTargets:[1]},{sWidth:"10%",aTargets:[2]},{sWidth:"10%",aTargets:[3]},{sWidth:"10%",aTargets:[4]},{sWidth:"10%",aTargets:[5]},{sWidth:"20%",aTargets:[6]},{sWidth:"10%",aTargets:[7]}],autoWidth:!1,lengthChange:!1,info:!1,bSort:!1,bPaginate:!1,bFilter:!1,fnDrawCallback:function(e){$("div.dataTables_wrapper div.dataTables_filter label").contents().filter(function(){return 1!=this.nodeType}).replaceWith(""),$("div.dataTables_wrapper div.dataTables_filter label input").addClass("form-control"),$("div.dataTables_wrapper div.dataTables_filter label input").addClass("input-inline"),$("div.dataTables_wrapper div.dataTables_filter label input").addClass("input-medium"),$("div.dataTables_wrapper div.dataTables_filter label input").attr("placeholder","Search..."),$("div.dataTables_wrapper div.dataTables_filter label input").attr("id","inputSuccess"),$(".btn_edit_item").click(function(){var e=JSON.parse($(this).attr("item_obj"));$(".info_sender").html(e.sender.username),$(".info_receiver").html(e.receiver.username),$(".info_amount_after").html(e.balanceAfter),$(".info_amount_before").html(e.balanceBefore),$(".info_status").html(e.status),$("#modal_add_edit").modal("show")}),$(".btn_delete_item").click(function(){deleted_id=parseInt($(this).attr("item_id")),$("#modal_confirm").modal("show")})}}),$.ajax({url:base_request_url+"/admin/user",type:"GET",data:{limit:10,offset:0},contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$(e.dataArr).each(function(e,t){$("#single_select_user").append("<option value='"+t.id+"'> "+t.username+"</option>"),$("#single_select_receiver").append("<option value='"+t.id+"'> "+t.username+"</option>")}),load_autocomplete_component()},error:function(e){console.log(e.error())}}),$(".date-picker").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0}),$(".btn_add_new_item").click(function(){$("#modal_add_edit .modal-title").html("Create new "+item_name),$("#modal_add_edit input:text").val(""),$(".txt_add_edit_item_channel").attr("name","channelId"),channel_arr=[],$(".current_channels").html(""),$("#modal_add_edit .btn_modal_save_new").show(),$("#modal_add_edit .btn_modal_save_update").hide(),$("#modal_add_edit").modal("show")}),$(".search_submit").click(function(){sender=parseInt($("#single_select_user").val()),receiver=parseInt($("#single_select_receiver").val()),start_time=$(".txt_add_edit_item_dateStart").val(),end_time=$(".txt_add_edit_item_dateEnd").val(),from_amount=$(".txt_add_edit_item_from_amount").val(),to_amount=$(".txt_add_edit_item_to_amount").val(),order_by=$("#single_select_order_by").val(),reload_widget(),page_datatable.ajax.reload(null,!1)}),$(".search_clear").click(function(){$("#single_select_user").val(""),$("#single_select_receiver").val(""),$(".txt_add_edit_item_dateStart").val(""),$(".txt_add_edit_item_dateEnd").val(""),$(".txt_add_edit_item_from_amount").val(""),$(".txt_add_edit_item_to_amount").val(""),$("#single_select_order_by").val(""),load_autocomplete_component(),sender=null,receiver=null,start_time=null,end_time=null,from_amount=null,to_amount=null,order_by=null,reload_widget(),page_datatable.ajax.reload(null,!1)}),$(".select2").on("select2:open",function(){if($(this).parents("[class*='has-']").length)for(var e=$(this).parents("[class*='has-']")[0].className.split(/\s+/),t=0;t<e.length;++t)e[t].match("has-")&&$("body > .select2-container").addClass(e[t]);"single_select_user"==$(this).attr("id")&&(typing_input=$(".select2-search__field")[0],$(typing_input).on("keypress",function(){console.log("press single"),$(".select2-results__option").html("Searching"),clearTimeout(typingTimer),typingTimer=setTimeout(function(){_send_info.data={limit:10,offset:0,searchValue:$(typing_input).val()},searching_value_timeout=$(typing_input).val(),$("#single_select_user").html(""),$.ajax({url:base_request_url+"/admin/user",type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){console.log("success");$(e.dataArr).each(function(e,t){$("#single_select_user").append("<option value='"+t.id+"'> "+t.username+"</option>")}),load_autocomplete_component(),$("#single_select_user").select2("open"),$($(".select2-search__field")[0]).val(searching_value_timeout)},error:function(e){console.log("error"),console.log(e.error())}})},doneTypingInterval)})),"single_select_receiver"==$(this).attr("id")&&(typing_input=$(".select2-search__field")[0],$(typing_input).on("keypress",function(){console.log("press"),clearTimeout(typingTimer),typingTimer=setTimeout(function(){_send_info.data={limit:10,offset:0,searchValue:$(typing_input).val()},searching_value_timeout=$(typing_input).val(),$("#single_select_receiver").html(""),$.ajax({url:base_request_url+"/admin/user",type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){console.log("success");$(e.dataArr).each(function(e,t){$("#single_select_receiver").append("<option value='"+t.id+"'> "+t.username+"</option>")}),load_autocomplete_component(),$("#single_select_receiver").select2("open"),$($(".select2-search__field")[0]).val(searching_value_timeout)},error:function(e){console.log("error"),console.log(e.error())}})},doneTypingInterval)}))})};jQuery(document).ready(function(){Page_script.init(),load_page()});