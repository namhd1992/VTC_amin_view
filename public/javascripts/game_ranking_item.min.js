function str_pad(e){return String("00"+e).slice(-2)}var editing_item=null,search_value=null,game_raking=null,page_datatable=null,deleted_obj=null,deleted_id=null;_current_page=1;var imageLogo=null,linkImage=null,itemType=null,Page_script={init:function(){}};_send_info.data={limit:1e3,offset:0};var load_page=function(){function e(e,t,a,i,_){switch($(".item_content").hide(),e){case"GIFTCODE":$(".txt_add_edit_item_giftcode_info").text(""),$(".giftcode_file").show(),$(".txt_add_edit_item_giftcode_info").text(t),n();break;case"INGAME":case"REAL":$(".txt_add_edit_item_description").val(t),$(".item_description").show();break;case"TURN_LUCKYSPIN":$("#txt_add_edit_item_luckyspin").val(i),$(".form_quantity").val(_),$(".item_luckyspin").show(),$(".form_quantity").show(i);break;case"XU":case"SCOIN":$(".txt_add_edit_item_value").val(a),$(".item_value").show();break;case"CARD":$("#txt_add_edit_item_value_card").val(a),$(".item_card_value").show()}}function t(e){_send_info.data={id:editing_item,gameRankingId:game_ranking_id,gameRankingRankId:rank_id,itemName:$(".txt_add_edit_item_name").val(),itemType:$("#single_select_item_type").val(),itemValue:$(".txt_add_edit_item_value").val(),itemIconUrl:$(".txt_add_edit_item_link_logo").text(),itemQuantity:$(".txt_add_edit_item_quantity").val(),objectId:$("#txt_add_edit_item_luckyspin").val(),description:$(".txt_add_edit_item_description").val()},"CARD"==itemType&&(_send_info.data.itemValue=$("#txt_add_edit_item_value_card").val());var t="";switch(e){case"CREATE":editing_item=null,t="POST";break;case"UPDATE":t="PUT"}if($(".loading_icon").show(),"GIFTCODE"==$("#single_select_item_type").val()&&null!=$("#txt_add_edit_item_giftcode_file")[0].files[0]){var a=new FormData;a.append("codeFile",$("#txt_add_edit_item_giftcode_file")[0].files[0]),a.append("eventType","GAME_RANKING"),a.append("mainEventId",game_ranking_id),a.append("subEventId",rank_id),$.ajax({url:base_request_url+"/admin/giftcode",type:"POST",data:a,cache:!1,async:!1,contentType:!1,timeout:3e6,processData:!1,beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){"01"==e.status?$("#txt_add_edit_item_giftcode_info").text(""):show_toast_notif("error","Fail",e.message,function(){})},error:function(e){console.log(_send_info.data),show_toast_notif("error","Fail","Error '"+e.responseText+"'",function(){}),$(".loading_icon").hide()}})}$.ajax({url:base_request_url+"/admin/game-ranking-item",type:t,data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){page_datatable.ajax.reload(null,!1),"01"==e.status?(show_toast_notif("success","Successfully","Updated '"+$(".txt_add_edit_item_name").val()+"'",function(){}),$("#modal_add_edit").modal("hide")):show_toast_notif("error","Fail",e.message,function(){}),$(".loading_icon").hide()},error:function(e){console.log(_send_info.data),show_toast_notif("error","Fail","Error '"+e.responseText+"'",function(){}),$(".loading_icon").hide()}})}function a(e){if(flagNewImage&&null!=e&&null!=e){var t=new FormData;t.append("image",e),$(".loading_icon").show(),$.ajax({url:base_request_url+"/admin/uploadImage",type:"POST",data:t,cache:!1,async:!1,contentType:!1,timeout:3e6,processData:!1,beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){"01"==e.status?(linkImage=e.data,i($("#modal_add_edit .txt_add_edit_item_link_logo").html()),$(".loading_icon").hide(),show_toast_notif("success","Successfully","Add new image success")):($(".loading_icon").hide(),show_toast_notif("error","Fail","Upload Image Unsuccess"))},error:function(e){show_toast_notif("error","Fail","Error '"+e.message+"'"),$(".loading_icon").hide()}})}}function i(e){flagNewImage&&(_send_info.data={urlImage:e},$.ajax({url:base_request_url+"/admin/deleteImage",type:"POST",data:JSON.stringify(_send_info.data),cache:!1,async:!1,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){page_datatable.ajax.reload(null,!1),"01"==e.status?(flagNewImage=!1,$(".loading_icon").hide(),show_toast_notif("success","Successfully","Add new and Delete old image success")):(show_toast_notif("error","Fail","Delete Image Unsuccess"),$(".loading_icon").hide())},error:function(e){show_toast_notif("error","Fail","Error '"+e.message+"'"),$(".loading_icon").hide()}}))}function n(){$.ajax({url:base_request_url+"/admin/giftcode?eventType=GAME_RANKING&mainEventId="+game_ranking_id+"&subEventId="+rank_id,type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){giftcodeInfo=e.data;var t=$(".txt_add_edit_item_giftcode_info").text()+" ( Tổng : "+giftcodeInfo.giftcodeTotal+", Đã Trao : "+giftcodeInfo.giftcodeGave+" )";$(".txt_add_edit_item_giftcode_info").text(t)},error:function(e){console.log(e.error())}})}_send_info.data={limit:_per_page,offset:_per_page*(_current_page-1)},$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"}),page_datatable=$("#page_datatable").DataTable({ajax:{url:base_request_url+"/admin/game-ranking-item?rank_id="+rank_id,type:"GET",data:function(e){null!=search_value&&""!=search_value&&(e.searchValue=search_value),e.limit=_per_page,e.offset=_per_page*(_current_page-1)},contentType:"application/json",dataType:"json",dataSrc:function(e){console.log(e);var t=0;if($(".datatable_paging").html(""),e.totalRecords>_per_page)for(t=1;t<=Math.ceil(e.totalRecords/_per_page);t++)t==_current_page?$(".datatable_paging").append("<span class='datatable_paging_number_active' page="+t+">"+t+"</span>"):1!=t&&t!=Math.ceil(e.totalRecords/_per_page)&&t!=_current_page-1&&t!=_current_page-2&&t!=_current_page+2&&t!=_current_page+1||(1==t&&_current_page>4?($(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"),$($(".datatable_paging_number")[0]).after("<span class='paging_truncate'>...</span>")):t==Math.ceil(e.totalRecords/_per_page)&&_current_page<Math.ceil(e.totalRecords/_per_page)-3?($(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"),$($(".datatable_paging_number")[$(".datatable_paging_number").length-1]).before("<span class='paging_truncate'>...</span>")):$(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"));else $(".datatable_paging").html("<span class='datatable_paging_number_active' page=1>1</span>");return $(".datatable_paging_number").click(function(e){_current_page=parseInt($(e.target).attr("page")),page_datatable.ajax.reload()}),null!=e.data?e.data:[]},beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},error:function(e,t,a){"invalid_token"==JSON.parse(e.responseText).error&&(localStorage.removeItem("user_data"),document.location.replace("login"))}},responsive:!1,columns:[{title:"ID",data:"id"},{title:"Icon",data:null,render:function(e,t,a,i){var n="";return n+="<img src='"+a.itemIconUrl+"' style='height: 40px;width: 40px'>",n}},{title:" Tên Phúc Lợi",data:"itemName"},{title:"Kiểu Phúc Lợi",data:null,render:function(e,t,a,i){var n="";switch(a.itemType){case"GIFTCODE":n="Giftcode";break;case"INGAME":n="Quà ingame";break;case"REAL":n="Hiện Vật";break;case"TURN_LUCKYSPIN":n="Lượt chơi event";break;case"XU":n="Xu";break;case"SCOIN":n="Scoin";break;case"CARD":n="Thẻ Scoin"}return n}},{title:"Giá Trị",data:null,render:function(e,t,a,i){var n="";switch(a.itemType){case"GIFTCODE":case"INGAME":case"REAL":n=a.description;break;case"TURN_LUCKYSPIN":n=a.itemQuantity;break;case"XU":case"SCOIN":case"CARD":n=a.itemValue}return n}},{title:"Create On",data:null,render:function(e,t,a,i){var n=moment(a.createOn).format("YYYY-MMMM-D HH:mm");return n}},{title:"Action",data:null,render:function(e,t,a,i){var n="";return n+="<a class='btn_edit_item' item_id='"+a.id+"' item_obj='"+JSON.stringify(a)+"'><i class='icon-wrench'></i> Edit </a>",n+="<a class='btn_delete_item' item_id='"+a.id+"' item_obj='"+JSON.stringify(a)+"'><i class='icon-trash'></i> Delete </a>",n}}],aoColumnDefs:[{responsivePriority:1,sWidth:"2%",aTargets:[0]},{responsivePriority:2,sWidth:"4%",aTargets:[1]},{responsivePriority:2,sWidth:"26%",aTargets:[2]},{responsivePriority:2,sWidth:"20%",aTargets:[3]},{responsivePriority:2,sWidth:"10%",aTargets:[4]},{responsivePriority:2,sWidth:"20%",aTargets:[5]},{responsivePriority:2,sWidth:"10%",aTargets:[5]}],autoWidth:!0,lengthChange:!0,info:!1,bSort:!0,bFilter:!1,bPaginate:!1,fnDrawCallback:function(t){$(".btn_edit_item").click(function(){var t=JSON.parse($(this).attr("item_obj"));editing_item=t.id,itemType=t.itemType,$(".txt_add_edit_item_name").val(t.itemName),$("#modal_add_edit .txt_add_edit_item_link_logo").html(""),$("#modal_add_edit .logo_img").css("background-image","url("+t.itemIconUrl+")"),$("#modal_add_edit .txt_add_edit_item_link_logo").html(t.itemIconUrl),$(".txt_add_edit_item_quantity").val(t.itemQuantity),$(".txt_add_edit_item_description").val(t.description),$("#single_select_item_type").val(t.itemType),e(t.itemType,t.description,t.itemValue,t.objectId,t.itemQuantity),$("#single_select_item_type").change(function(){e($("#single_select_item_type").val(),null,0,0,0)}),$("#modal_add_edit .btn_modal_save_new").hide(),$("#modal_add_edit .btn_modal_save_update").show(),$("#modal_add_edit").modal("show")}),$(".btn_delete_item").click(function(){var e=JSON.parse($(this).attr("item_obj"));deleted_obj=e,deleted_id=e.id,$("#modal_confirm").modal("show")})}}),$(".txt_add_edit_item_file_logo").change(function(){var e=this.files[0];(e="image/jpeg"==e.type||"image/png"==e.type||"image/jpg"==e.type||"image/gif"==e.type)?(imageLogo=this.files[0],$("#modal_add_edit .txt_add_edit_item_image_logo").css("background-image","url("+URL.createObjectURL(imageLogo)+")"),flagNewImage=!0,$(".txt_add_edit_item_file_logo").val("")):(show_toast_notif("error","Error","Không Đúng Định Dạng Ảnh",function(){}),imageLogo=null)}),$(".btn_modal_upload_image_logo").click(function(){a(imageLogo),null==linkImage?show_toast_notif("error","Lỗi Tải Ảnh","Chưa chọn ảnh",function(){}):($("#modal_add_edit .txt_add_edit_item_link_logo").html(linkImage),linkImage=null)}),$("#txt_add_edit_item_giftcode_file").change(function(){$(".txt_add_edit_item_giftcode_info").text(this.files[0].name),$(".txt_add_edit_item_description").val(this.files[0].name)}),$(".btn_add_new_item").click(function(){$("#add_edit_game_ranking_form").trigger("reset"),$(".item_clone").remove(),$("#modal_add_edit .btn_modal_save_new").show(),$("#modal_add_edit .btn_modal_save_update").hide(),$("#modal_add_edit").modal("show"),$(".item_content").hide(),$("#modal_add_edit .logo_img").css("background-image","url()"),$("#modal_add_edit .txt_add_edit_item_link_logo").html(""),$("#single_select_item_type").change(function(){e($("#single_select_item_type").val(),null,0,0,0)}),$("#modal_add_edit .btn_modal_save_new").click(function(){t("CREATE")})}),$("#modal_add_edit .btn_modal_save_update").click(function(){t("UPDATE")}),$(".btn_confirm_yes").click(function(){$.ajax({url:base_request_url+"/admin/game-ranking-item?id="+deleted_id,type:"DELETE",contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(){$("#modal_confirm").modal("hide"),_send_info.data={},page_datatable.ajax.reload(),$("#modal_add_edit").modal("hide"),show_toast_notif("success","Successfully","Deleted: '"+deleted_obj.name+"'",function(){})},error:function(e){show_toast_notif("error","Error","'"+e.responseText+"'",function(){})}})}),$("#single_select_game").change(function(){var e=$("#single_select_game").val();0!=e?$(".txt_add_edit_service_id").attr("disabled","disable"):$(".txt_add_edit_service_id").removeAttr("disabled"),console.log(e),$(".txt_add_edit_service_id").val(e)}),$.ajax({url:base_request_url+"/admin/game-ranking-rank/"+rank_id,type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){rank=e.data,$(".rank_name").text(rank.rankName)},error:function(e){console.log(e.error())}}),$.ajax({url:base_request_url+"/admin/luckySpin?status=active",type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$(e.data).each(function(e,t){$("#txt_add_edit_item_luckyspin").append("<option value='"+t.id+"'> "+t.name+"</option>")})},error:function(e){console.log(e.error())}})};jQuery(document).ready(function(){Page_script.init(),load_page()});