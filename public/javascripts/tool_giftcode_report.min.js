var editing_item=null;var item_name="Auction Report";var item_names="Auctions";var deleted_id=null;var search_value=null;var page_datatable=null;var deleted_obj=null;var load_autocomplete_component=null;_current_page=1;var doneTypingInterval=500;var typingTimer;var searching_value_timeout="";var Page_script=function(){return{init:function(){}}}();function str_pad(a){return String("00"+a).slice(-2)}var load_page=function(){if(!checkFunction("gameManager")){$(".btn_add_new_item").hide()}_send_info.data={limit:_per_page,offset:_per_page*(_current_page-1)};$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"});page_datatable=$("#page_datatable").DataTable({ajax:{url:base_request_url+"/admin/reportDistributeGiftcode",type:"GET",data:function(a){if(search_value!=null&&search_value!=""){a.searchValue=search_value}a.limit=_per_page;a.offset=_per_page*(_current_page-1)},contentType:"application/json",dataType:"json",dataSrc:function(b){var a=0;$(".datatable_paging").html("");if(b.totalRecords>_per_page){for(a=1;a<=Math.ceil(b.totalRecords/_per_page);a++){if(a==_current_page){$(".datatable_paging").append("<span class='datatable_paging_number_active' page="+a+">"+a+"</span>")}else{if(a==1||a==Math.ceil(b.totalRecords/_per_page)||a==(_current_page-1)||a==(_current_page-2)||a==(_current_page+2)||a==(_current_page+1)){if(a==1&&_current_page>4){$(".datatable_paging").append("<span class='datatable_paging_number' page="+a+">"+a+"</span>");$($(".datatable_paging_number")[0]).after("<span class='paging_truncate'>...</span>")}else{if(a==Math.ceil(b.totalRecords/_per_page)&&_current_page<(Math.ceil(b.totalRecords/_per_page)-3)){$(".datatable_paging").append("<span class='datatable_paging_number' page="+a+">"+a+"</span>");$($(".datatable_paging_number")[$(".datatable_paging_number").length-1]).before("<span class='paging_truncate'>...</span>")}else{$(".datatable_paging").append("<span class='datatable_paging_number' page="+a+">"+a+"</span>")}}}}}}else{$(".datatable_paging").html("<span class='datatable_paging_number_active' page="+1+">"+1+"</span>")}$(".datatable_paging_number").click(function(c){_current_page=parseInt($(c.target).attr("page"));page_datatable.ajax.reload()});if(b.dataArr!=null){return b.dataArr}else{return[]}},beforeSend:function(a){a.setRequestHeader("Authorization","bearer "+_user_data.access_token)},error:function(c,a,b){if(JSON.parse(c.responseText).error=="invalid_token"){localStorage.removeItem("user_data");document.location.replace("login")}}},columns:[{title:"ID",data:"id"},{title:"Title",data:"title"},{title:"From",data:"fromEmail"},{title:"To",data:"toEmail"},{title:"Create On",data:null,render:function(c,b,a,e){var d=moment(a.createOn).format("YYYY-MMMM-D HH:mm");return d}}],aoColumnDefs:[{sWidth:"2%",aTargets:[0]},{sWidth:"20%",aTargets:[1]},{sWidth:"20%",aTargets:[2]},{sWidth:"10%",aTargets:[3]},{sWidth:"30%",aTargets:[4]}],autoWidth:false,lengthChange:false,info:false,bSort:false,bFilter:false,bPaginate:false,fnDrawCallback:function(a){$("div.dataTables_wrapper div.dataTables_filter label").contents().filter(function(){return this.nodeType!=1}).replaceWith("");$(".btn_edit_item").click(function(){var b=JSON.parse($(this).attr("item_obj"));console.log(b);editing_item=b.id;$("#modal_add_edit .modal-title").html("Detail "+item_name);$(".txt_add_edit_item_name").val(b.auctionEvent.name);$(".txt_add_edit_item_username").val(b.userInfo.fullName);$(".txt_add_edit_item_price").val(b.currentPrice);var c=getSetting(_setting_data,"date_format");$(".txt_add_edit_item_from_date").val(moment.unix(b.createOn/1000).format(c.value));$("#modal_add_edit").modal("show")});$(".btn_delete_item").click(function(){var b=JSON.parse($(this).attr("item_obj"));deleted_obj=b;deleted_id=b.id;$("#modal_confirm").modal("show")})}});$(".select2, .select2-multiple, .select2-allow-clear, .js-data-example-ajax").on("select2:open",function(){if($(this).parents("[class*='has-']").length){var b=$(this).parents("[class*='has-']")[0].className.split(/\s+/);for(var a=0;a<b.length;++a){if(b[a].match("has-")){$("body > .select2-container").addClass(b[a])}}}});load_autocomplete_component=function(){$.fn.select2.defaults.set("theme","bootstrap");var c="Type to search";$(".select2, .select2-multiple").select2({placeholder:c,width:null});$(".select2-allow-clear").select2({allowClear:true,placeholder:c,width:null});function b(e){if(e.loading){return e.text}var d="<div class='select2-result-repository clearfix'><div class='select2-result-repository__avatar'><img src='"+e.owner.avatar_url+"' /></div><div class='select2-result-repository__meta'><div class='select2-result-repository__title'>"+e.full_name+"</div>";if(e.description){d+="<div class='select2-result-repository__description'>"+e.description+"</div>"}d+="<div class='select2-result-repository__statistics'><div class='select2-result-repository__forks'><span class='glyphicon glyphicon-flash'></span> "+e.forks_count+" Forks</div><div class='select2-result-repository__stargazers'><span class='glyphicon glyphicon-star'></span> "+e.stargazers_count+" Stars</div><div class='select2-result-repository__watchers'><span class='glyphicon glyphicon-eye-open'></span> "+e.watchers_count+" Watchers</div></div></div></div>";return d}function a(d){return d.full_name||d.text}$(".js-data-example-ajax").select2({width:"off",ajax:{url:"https://api.github.com/search/repositories",dataType:"json",delay:250,data:function(d){return{q:d.term,page:d.page}},processResults:function(e,d){return{results:e.items}},cache:true},escapeMarkup:function(d){return d},minimumInputLength:1,templateResult:b,templateSelection:a});$("button[data-select2-open]").click(function(){$("#"+$(this).data("select2-open")).select2("open")});$(":checkbox").on("click",function(){$(this).parent().nextAll("select").prop("disabled",!this.checked);if($(this).val()==1&&$(this).parent().hasClass("checked")){$(".appname_group").show();$(".txt_add_edit_item_package_android").attr("name","androidPackage");$(".txt_add_edit_item_package_ios").attr("name","iosSchemes")}else{if($(this).val()==1&&!$(this).parent().hasClass("checked")){$(".appname_group").hide();$(".txt_add_edit_item_package_android").attr("name","");$(".txt_add_edit_item_package_ios").attr("name","")}}if($(this).val()==3&&$(this).parent().hasClass("checked")){$(".share_group").show();$(".txt_add_edit_item_share").attr("name","urlShareFB")}else{if($(this).val()==3&&!$(this).parent().hasClass("checked")){$(".share_group").hide();$(".txt_add_edit_item_share").attr("name","")}}});$(".js-btn-set-scaling-classes").on("click",function(){$("#select2-multiple-input-sm, #select2-single-input-sm").next(".select2-container--bootstrap").addClass("input-sm");$("#select2-multiple-input-lg, #select2-single-input-lg").next(".select2-container--bootstrap").addClass("input-lg");$(this).removeClass("btn-primary btn-outline").prop("disabled",true)})};$(".date-picker").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:true});$(".btn_add_new_item").click(function(){$("#modal_add_edit .modal-title").html("Create new "+item_name);$("#modal_add_edit input:text").val("");$("#modal_add_edit textarea").val("");$("#modal_add_edit .txt_add_edit_item_start_amount").val(1);$("#modal_add_edit .txt_add_edit_item_price_step").val(1);$(".select_status option").filter(function(){return $.trim($(this).val())=="active"}).prop("selected",true);$(".select_status").selectpicker("refresh");$(".select_status button").css("background-color","#32c5d2");load_autocomplete_component();$("#modal_add_edit .btn_modal_save_new").show();$("#modal_add_edit .btn_modal_save_update").hide();$("#modal_add_edit").modal("show")});$(".btn_confirm_yes").click(function(){$.ajax({url:base_request_url+"/admin/auction?auctionEventId="+deleted_id,type:"DELETE",contentType:"application/json",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(){$("#modal_confirm").modal("hide");_send_info.data={};page_datatable.ajax.reload();$("#modal_add_edit").modal("hide");show_toast_notif("success","Successfully","Deleted: '"+deleted_obj.name+"'",function(){})},error:function(a){show_toast_notif("error","Error","'"+a.responseText+"'",function(){})}})});$(".btn_modal_save_new").click(function(){if($(".txt_add_edit_item_name").val()==""){show_toast_notif("error","Unable to create "+item_name,item_name+" name is required");return}_send_info.data={name:$(".txt_add_edit_item_name").val(),defaultImage:$(".txt_add_edit_item_image").val(),description:$(".txt_add_edit_item_desc").val(),itemName:$(".txt_add_edit_item_item_name").val(),type:$("#single_select_type").val(),amountStart:$(".txt_add_edit_item_start_amount").val(),priceStep:$(".txt_add_edit_item_price_step").val(),fromDate:new moment($(".txt_add_edit_item_from_date").val(),"YYYY-MMMM-D hh:mm").unix()*1000,toDate:new moment($(".txt_add_edit_item_to_date").val(),"YYYY-MMMM-D hh:mm").unix()*1000,status:$(".select_status option:selected").val()};$(".loading_icon").show();$.ajax({url:base_request_url+"/admin/auction",type:"POST",data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(a){page_datatable.ajax.reload(null,false);if(a.onlyMessage=="Success"){show_toast_notif("success","Successfully","Created '"+$(".txt_add_edit_item_name").val()+"'",function(){});$("#modal_add_edit").modal("hide")}else{show_toast_notif("error","Fail",a.onlyMessage,function(){})}$(".loading_icon").hide()},error:function(a){show_toast_notif("error","Fail","Error '"+a.responseText+"'",function(){});$(".loading_icon").hide()}})});$(".btn_modal_save_update").click(function(){if($(".txt_add_edit_item_name").val()==""){show_toast_notif("error","Unable to update "+item_name,item_name+" name is required");return}_send_info.data={auctionEventId:editing_item,name:$(".txt_add_edit_item_name").val(),defaultImage:$(".txt_add_edit_item_image").val(),description:$(".txt_add_edit_item_desc").val(),itemName:$(".txt_add_edit_item_item_name").val(),type:$("#single_select_type").val(),amountStart:$(".txt_add_edit_item_start_amount").val(),priceStep:$(".txt_add_edit_item_price_step").val(),fromDate:new moment($(".txt_add_edit_item_from_date").val(),"YYYY-MMMM-D hh:mm").unix()*1000,toDate:new moment($(".txt_add_edit_item_to_date").val(),"YYYY-MMMM-D hh:mm").unix()*1000,status:$(".select_status option:selected").val()};$(".loading_icon").show();$.ajax({url:base_request_url+"/admin/auction",type:"PUT",data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(a){page_datatable.ajax.reload(null,false);if(a.onlyMessage=="Success"){show_toast_notif("success","Successfully","Updated '"+$(".txt_add_edit_item_name").val()+"'",function(){});$("#modal_add_edit").modal("hide")}else{show_toast_notif("error","Fail",a.onlyMessage,function(){})}$(".loading_icon").hide()},error:function(a){show_toast_notif("error","Fail","Error '"+a.responseText+"'",function(){});$(".loading_icon").hide()}})});$(".select_status").change(function(){if($(this).val()!=""){if($(this).val()=="active"){$(".select_status button").css("background-color","#32c5d2")}else{if($(this).val()=="inactive"){$(".select_status button").css("background-color","red")}}$(".hidden_item_status").val($(this).val())}});$(".search_submit").click(function(){search_value=$(".search_input").val();page_datatable.ajax.reload(null,false)});$(".search_clear").click(function(){$(".search_input").val("");search_value="";page_datatable.ajax.reload(null,false)});$(".form_datetime").datetimepicker({autoclose:true,isRTL:App.isRTL(),format:"yyyy-MM-dd HH:ii",pickerPosition:(App.isRTL()?"bottom-right":"bottom-left")})};function objectifyForm(c){var b={};for(var a=0;a<c.length;a++){b[c[a]["name"]]=c[a]["value"]}return b}jQuery(document).ready(function(){Page_script.init();load_page()});