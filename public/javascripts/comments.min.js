var editing_item=null,item_name="Comment",item_names="Comments",deleted_id=null,page_datatable=null,data_list=null;_current_page=1;var search_value=null,Page_script=function(){return{init:function(){}}}(),load_page=function(){_send_info.data={},$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"}),$.fn.dataTable.ext.errMode="none",page_datatable=$("#page_datatable").DataTable({ajax:{url:base_request_url+"/getCommentArticle",type:"POST",data:function(e){var t=$(".filter_link_active").attr("status_val"),a={limit:_per_page,offset:_per_page*(_current_page-1)};return"all"!=t&&(a.status=t),null!=search_value&&(a.searchValue=search_value),JSON.stringify(a)},contentType:"application/json",dataType:"json",dataSrc:function(e){var t=$(".filter_link_active").attr("status_val");data_list=e.dataArr;var a=(data_list.length,0),n=0;$(data_list).each(function(e,i){"active"==i.status?a++:n++,"all"!=t&&i.status!=t&&data_list.splice(data_list.indexOf(i),1)}),$.ajax({url:base_request_url+"/getCommentArticle",type:"POST",contentType:"application/json",data:JSON.stringify({limit:1,offset:0,status:"active"}),dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$(".filter_active").html(e.totalRecords)},error:function(e){console.log(e)}}),$.ajax({url:base_request_url+"/getCommentArticle",type:"POST",contentType:"application/json",data:JSON.stringify({limit:1,offset:0}),dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$(".filter_all").html(e.totalRecords)},error:function(e){console.log(e)}}),$.ajax({url:base_request_url+"/getCommentArticle",type:"POST",contentType:"application/json",data:JSON.stringify({limit:1,offset:0,status:"inactive"}),dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$(".filter_inactive").html(e.totalRecords)},error:function(e){console.log(e)}});var i=0;if($(".datatable_paging").html(""),e.totalRecords>_per_page)for(i=1;i<=Math.ceil(e.totalRecords/_per_page);i++)i==_current_page?$(".datatable_paging").append("<span class='datatable_paging_number_active' page="+i+">"+i+"</span>"):1!=i&&i!=Math.ceil(e.totalRecords/_per_page)&&i!=_current_page-1&&i!=_current_page-2&&i!=_current_page+2&&i!=_current_page+1||(1==i&&_current_page>4?($(".datatable_paging").append("<span class='datatable_paging_number' page="+i+">"+i+"</span>"),$($(".datatable_paging_number")[0]).after("<span class='paging_truncate'>...</span>")):i==Math.ceil(e.totalRecords/_per_page)&&_current_page<Math.ceil(e.totalRecords/_per_page)-3?($(".datatable_paging").append("<span class='datatable_paging_number' page="+i+">"+i+"</span>"),$($(".datatable_paging_number")[$(".datatable_paging_number").length-1]).before("<span class='paging_truncate'>...</span>")):$(".datatable_paging").append("<span class='datatable_paging_number' page="+i+">"+i+"</span>"));else $(".datatable_paging").html("<span class='datatable_paging_number_active' page=1>1</span>");return $(".datatable_paging_number").click(function(e){_current_page=parseInt($(e.target).attr("page")),page_datatable.ajax.reload()}),data_list},beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},error:function(e,t,a){"invalid_token"==JSON.parse(e.responseText).error&&(localStorage.removeItem("user_data"),document.location.replace("login"))}},columns:[{title:"Avatar",data:null,render:function(e,t,a,n){var i=a.firstName+" "+a.lastName;null==a.firstName&&null==a.lastName&&(i="Anonymous");var l="",r="/images/default_ava.jpg";return null!==a.urlAvatar&&(r=a.urlAvatar),l+="<img class='userava_tbl'src='"+r+"' />"}},{title:"Username",data:null,render:function(e,t,a,n){var i=a.fullName;null!=a.fullName&&""!=a.fullName||(i=a.userName);var l="",r="/images/default_ava.jpg";return null!==a.urlAvatar&&(r=a.urlAvatar),l+="<div class='username_tbl'>"+i+"</div>"}},{title:"Content",data:null,render:function(e,t,a,n){var i="";return i+="<div class='title_content'>",i+=a.content,i+="</div>"}},{title:"Article",data:null,render:function(e,t,a,n){var i="";return i+=a.titleNewsOverView,i+=" ( <i class='fa fa-commenting'></i> "+a.numberComment+")"}},{title:"Date",data:null,render:function(e,t,a,n){var i=getSetting(_setting_data,"date_format"),l=moment.unix(a.createOn/1e3).format(i.value);return l}},{title:"Action",data:null,render:function(e,t,a,n){var i="";return checkFunction("updateComment")&&(i+="<a class='btn_edit_item btn btn-link' item_id='"+a.commentId+"' item_obj='"+escape(JSON.stringify(a))+"' ><i class='icon-wrench'></i> Edit </a>"),checkFunction("deleteComment")&&(i+="<a class='btn_delete_item btn btn-link' item_id='"+a.commentId+"' ><i class='icon-trash'></i> Delete </a>"),i}}],aoColumnDefs:[{sWidth:"10%",aTargets:[0]},{sWidth:"20%",aTargets:[1]},{sWidth:"30%",aTargets:[2]},{sWidth:"30%",aTargets:[3]},{sWidth:"10%",aTargets:[4]}],autoWidth:!1,lengthChange:!1,info:!1,bSort:!1,bFilter:!1,bPaginate:!1,fnDrawCallback:function(e){$("div.dataTables_wrapper div.dataTables_filter label").contents().filter(function(){return 1!=this.nodeType}).replaceWith(""),$("div.dataTables_wrapper div.dataTables_filter label input").addClass("form-control"),$("div.dataTables_wrapper div.dataTables_filter label input").addClass("input-inline"),$("div.dataTables_wrapper div.dataTables_filter label input").addClass("input-medium"),$("div.dataTables_wrapper div.dataTables_filter label input").attr("placeholder","Search..."),$("div.dataTables_wrapper div.dataTables_filter label input").attr("id","inputSuccess"),$(".btn_edit_item").click(function(){editing_item=$(this).attr("item_id");var e=findBy(data_list,editing_item,"commentId");console.log(e),$("#modal_add_edit .modal-title").html("Edit "+item_name+" "+e.commentId),$("#modal_add_edit .area_add_edit_item_title").val(e.content),$("#modal_add_edit .btn_modal_save_new").hide(),$("#modal_add_edit .btn_modal_save_update").show(),jQuery(".select_status option").filter(function(){return $.trim($(this).val())==e.status}).prop("selected",!0),$(".select_status").selectpicker("refresh"),"active"==e.status?$(".select_status button").css("background-color","#32c5d2"):$(".select_status button").css("background-color","red"),$("#modal_add_edit").modal("show")}),$(".btn_delete_item").click(function(){deleted_id=parseInt($(this).attr("item_id")),$("#modal_confirm").modal("show")})}}),$("#page_datatable").on("order.dt",function(){}).on("search.dt",function(){}).on("page.dt",function(){}).dataTable()};jQuery(document).ready(function(){Page_script.init(),load_page(),$(".search_submit").click(function(){search_value=$(".search_input").val(),page_datatable.ajax.reload(null,!1)}),$(".search_clear").click(function(){$(".search_input").val(""),search_value="",page_datatable.ajax.reload(null,!1)}),$(".btn_modal_save_update").click(function(){_send_info.data={content:$(".area_add_edit_item_title").val(),status:$(".select_status option:selected").val(),commentId:editing_item},$.ajax({url:base_request_url+"/admin/commentArticle",type:"PUT",data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(){_send_info.data={limit:1e4,offset:0},page_datatable.ajax.reload(null,!1),$("#modal_add_edit").modal("hide"),show_toast_notif("success","Successfully","Updated '"+editing_item+"'",function(){})},error:function(e){show_toast_notif("error","Successfully","Error '"+e.responseText+"'",function(){})}})}),$(".filter_link").click(function(){$(".filter_link").removeClass("filter_link_active"),$(this).addClass("filter_link_active"),_send_info.data={limit:1e4,offset:0},page_datatable.ajax.reload(null,!1)}),$(".select_status").change(function(){"active"==$(this).val()?$(".select_status button").css("background-color","#32c5d2"):"inactive"==$(this).val()&&$(".select_status button").css("background-color","red")}),$(".btn_confirm_yes").click(function(){_send_info.data={commentId:deleted_id},$.ajax({url:base_request_url+"/admin/commentArticle",type:"DELETE",data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(){$("#modal_confirm").modal("hide"),_send_info.data={},page_datatable.ajax.reload(),$("#modal_add_edit").modal("hide"),show_toast_notif("success","Successfully","Deleted: '"+deleted_id+"'",function(){})},error:function(e){show_toast_notif("error","Error","'"+e.responseText+"'",function(){})}})})});