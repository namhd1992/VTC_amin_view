function str_pad(e){return String("00"+e).slice(-2)}function objectifyForm(e){for(var t={},a=0;a<e.length;a++)t[e[a].name]=e[a].value;return t}function showTypeAction(){switch(parseInt($("#single_select_action").val())){case 1:$(".group_target").css("display","none"),$(".group_luckyspin").css("display","block");break;case 2:$(".group_target").css("display","none");break;case 3:case 4:$(".group_target").css("display","none"),$(".group_game").css("display","block");break;case 5:$(".group_target").css("display","none");break;case 6:$(".group_target").css("display","none"),$(".group_share_link").css("display","block")}}function importCard(e){if("GIFTCODE"===e.award&&null!=$("#txt_add_edit_giftcode_file")[0].files[0]&&null!=$("#txt_add_edit_giftcode_file")[0].files[0]){var t=new FormData;t.append("codeFile",$("#txt_add_edit_giftcode_file")[0].files[0]),t.append("eventType","MISSION"),t.append("mainEventId",e.id),$.ajax({url:base_request_url+"/admin/giftcode",type:"POST",data:t,cache:!1,async:!1,contentType:!1,timeout:3e6,processData:!1,beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){"01"==e.status?$("#txt_add_edit_item_giftcode_info").text(""):show_toast_notif("error","Fail",e.message,function(){})},error:function(e){console.log(_send_info.data),show_toast_notif("error","Fail","Error '"+e.responseText+"'",function(){}),$(".loading_icon").hide()}})}}function getDataAction(){switch(parseInt($("#single_select_action").val())){case 1:return[$("#single_select_lucky").val(),null];case 2:return[null,null];case 3:case 4:return[$("#single_select_game").val(),null];case 5:default:return[null,null]}}function dailyMission(e){8==e||9==e||10==e?($(".select_daily option").filter(function(){return"false"==$.trim($(this).val())}).prop("selected",!0),$(".select_daily").selectpicker("refresh"),$(".select_daily").attr("disabled","disabled"),$(".select_daily button").addClass("disabled")):($(".select_daily button").removeClass("disabled"),$(".select_daily").removeAttr("disabled"))}var editing_item=null,item_name="Mission",item_names="Missions",deleted_id=null,search_value=null,page_datatable=null,deleted_obj=null,load_autocomplete_component=null;_current_page=1;var typingTimer,doneTypingInterval=500,searching_value_timeout="";jQuery(document).ready(function(){Page_script.init(),load_page(),$("[name='my-checkbox']").bootstrapSwitch()});var Page_script={init:function(){}},load_page=function(){$(".group_luckyspin").css("display","block"),_send_info.data={limit:_per_page,offset:_per_page*(_current_page-1)},$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"}),page_datatable=$("#page_datatable").DataTable({ajax:{url:base_request_url+"/admin/mission",type:"GET",data:function(e){null!=search_value&&""!=search_value&&(e.searchValue=search_value),e.limit=_per_page,e.offset=_per_page*(_current_page-1)},contentType:"application/json",dataType:"json",dataSrc:function(e){var t=0;if($(".datatable_paging").html(""),e.totalRecords>_per_page)for(t=1;t<=Math.ceil(e.totalRecords/_per_page);t++)t==_current_page?$(".datatable_paging").append("<span class='datatable_paging_number_active' page="+t+">"+t+"</span>"):1!=t&&t!=Math.ceil(e.totalRecords/_per_page)&&t!=_current_page-1&&t!=_current_page-2&&t!=_current_page+2&&t!=_current_page+1||(1==t&&_current_page>4?($(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"),$($(".datatable_paging_number")[0]).after("<span class='paging_truncate'>...</span>")):t==Math.ceil(e.totalRecords/_per_page)&&_current_page<Math.ceil(e.totalRecords/_per_page)-3?($(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"),$($(".datatable_paging_number")[$(".datatable_paging_number").length-1]).before("<span class='paging_truncate'>...</span>")):$(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"));else $(".datatable_paging").html("<span class='datatable_paging_number_active' page=1>1</span>");return $(".datatable_paging_number").click(function(e){_current_page=parseInt($(e.target).attr("page")),page_datatable.ajax.reload()}),null!=e.data?(console.log(e.data),$.each(e.data,function(e,t){null!=t.valueLimit&&0!=t.valueLimit||(t.valueLimit="No Limited")}),e.data):[]},beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},error:function(e,t,a){"invalid_token"==JSON.parse(e.responseText).error&&(localStorage.removeItem("user_data"),document.location.replace("login"))}},columns:[{title:"ID",data:"id"},{title:"Name",data:"name"},{title:"Status",data:null,render:function(e,t,a,i){return e="active"==a.status?"<div class='active_status'>"+a.status+"</div>":"<div class='inactive_status'>"+a.status+"</div>",e}},{title:"Award",data:"award"},{title:"Award Limit",data:"valueLimit"},{title:"Create On",data:null,render:function(e,t,a,i){var n=moment(a.createOn).format("HH:mm DD/MM/YYYY");return n}},{title:"Action",data:null,render:function(e,t,a,i){var n="";return n+="<a class='btn_edit_item' item_id='"+a.id+"' item_obj='"+JSON.stringify(a)+"'><i class='icon-wrench'></i> Edit </a>",n+="<a class='btn_delete_item' item_id='"+a.id+"' item_obj='"+JSON.stringify(a)+"'><i class='icon-trash'></i> Delete </a>",n}}],aoColumnDefs:[{sWidth:"2%",aTargets:[0]},{sWidth:"13%",aTargets:[1]},{sWidth:"3%",aTargets:[2]},{sWidth:"3%",aTargets:[3]},{sWidth:"3%",aTargets:[4]},{sWidth:"7%",aTargets:[5]},{sWidth:"7%",aTargets:[6]}],autoWidth:!1,lengthChange:!1,info:!1,bSort:!0,bFilter:!1,bPaginate:!1,fnDrawCallback:function(e){$("div.dataTables_wrapper div.dataTables_filter label").contents().filter(function(){return 1!=this.nodeType}).replaceWith(""),$(".btn_edit_item").click(function(){var e=JSON.parse($(this).attr("item_obj"));switch(console.log(e),editing_item=e.id,$("#modal_add_edit .modal-title").html("Edit "+item_name+" "+e.name),$("#modal_add_edit .txt_add_edit_item_name").val(e.name),$("#modal_add_edit .txt_add_edit_item_type").val(e.gameType),$("#modal_add_edit .txt_add_edit_item_award").val(e.valueAward),$("#single_select_type_award").val(e.award),$("#single_select_action").val(e.action),dailyMission(1),e.action){case 1:$("#single_select_lucky").val(e.objectId);break;case 3:case 4:case 5:$("#single_select_game").val(e.objectId);break;case 6:$("#link_share").val(e.linkToShare);break;case 9:case 10:$("#single_select_game").val(e.objectId),dailyMission(9)}"TURN_SPIN"==$("#single_select_type_award").val()&&$("#select_spin_award").val(e.spinAwardId),$("#single_select_limit").val(e.typeLimit),$(".value_limit_award").val(e.valueLimit),$("#modal_add_edit .txt_add_edit_item_desc").val(e.description),$("#modal_add_edit .txt_add_edit_item_fb_value").val(e.objectValue),$("#modal_add_edit .txt_add_edit_item_game_value").val(e.objectValue);var t=getSetting(_setting_data,"date_format");$(".txt_add_edit_item_from_date").val(moment.unix(e.fromDate/1e3).format(t.value)),$(".txt_add_edit_item_to_date").val(moment.unix(e.toDate/1e3).format(t.value)),$("#modal_add_edit .btn_modal_save_new").hide(),$("#modal_add_edit .btn_modal_save_update").show(),$(".select_status option").filter(function(){return $.trim($(this).val())==e.status}).prop("selected",!0),$(".select_status").selectpicker("refresh"),$(".select_daily option").filter(function(){return $.trim($(this).val())==e.cyclic.toString()}).prop("selected",!0),$(".select_daily").selectpicker("refresh"),"active"==e.status?$(".select_status button").css("background-color","#32c5d2"):$(".select_status button").css("background-color","red"),load_autocomplete_component(),$("#modal_add_edit").modal("show"),1==e.highLights?$("[name='my-checkbox']").bootstrapSwitch("state",":checked"):$("[name='my-checkbox']").bootstrapSwitch("state","")}),$(".btn_delete_item").click(function(){var e=JSON.parse($(this).attr("item_obj"));deleted_obj=e,deleted_id=e.id,$("#modal_confirm").modal("show")})}}),load_autocomplete_component=function(){function e(e){if(e.loading)return e.text;var t="<div class='select2-result-repository clearfix'><div class='select2-result-repository__avatar'><img src='"+e.owner.avatar_url+"' /></div><div class='select2-result-repository__meta'><div class='select2-result-repository__title'>"+e.full_name+"</div>";return e.description&&(t+="<div class='select2-result-repository__description'>"+e.description+"</div>"),t+="<div class='select2-result-repository__statistics'><div class='select2-result-repository__forks'><span class='glyphicon glyphicon-flash'></span> "+e.forks_count+" Forks</div><div class='select2-result-repository__stargazers'><span class='glyphicon glyphicon-star'></span> "+e.stargazers_count+" Stars</div><div class='select2-result-repository__watchers'><span class='glyphicon glyphicon-eye-open'></span> "+e.watchers_count+" Watchers</div></div></div></div>",t}function t(e){return e.full_name||e.text}$.fn.select2.defaults.set("theme","bootstrap");var a="Type to search";$(".select2, .select2-multiple").select2({placeholder:a,width:null}),$(".select2-allow-clear").select2({allowClear:!0,placeholder:a,width:null}),$(".js-data-example-ajax").select2({width:"off",ajax:{url:"https://api.github.com/search/repositories",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){return{results:e.items}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1,templateResult:e,templateSelection:t}),$("button[data-select2-open]").click(function(){$("#"+$(this).data("select2-open")).select2("open")}),showTypeAction(),$("#single_select_action").change(function(){showTypeAction(),dailyMission($("#single_select_action").val())}),"GIFTCODE"==$("#single_select_type_award").val()?($(".type_award").hide(),$(".giftcode_file").show()):"TURN_SPIN"==$("#single_select_type_award").val()?($(".type_award").hide(),$(".turn_spin_award").show()):$(".type_award").hide(),$("#single_select_type_award").change(function(){"GIFTCODE"==$("#single_select_type_award").val()?($(".type_award").hide(),$(".giftcode_file").show()):"TURN_SPIN"==$("#single_select_type_award").val()?($(".type_award").hide(),$(".turn_spin_award").show()):$(".type_award").hide()}),""==$("#single_select_limit").val()&&$(".value_limit_award").attr("disabled","disabled"),$("#single_select_limit").change(function(){""==$("#single_select_limit").val()?($(".value_limit_award").attr("disabled","disabled"),$(".value_limit_award").val("")):$(".value_limit_award").removeAttr("disabled")}),$(".select2, .select2-multiple, .select2-allow-clear, .js-data-example-ajax").on("select2:open",function(){if($(this).parents("[class*='has-']").length)for(var e=$(this).parents("[class*='has-']")[0].className.split(/\s+/),t=0;t<e.length;++t)e[t].match("has-")&&$("body > .select2-container").addClass(e[t]);"single_select_lucky"==$(this).attr("id")&&(typing_input=$(".select2-search__field")[0],$(typing_input).on("keypress",function(){clearTimeout(typingTimer),typingTimer=setTimeout(function(){_send_info.data={limit:5,offset:0,searchValue:$(typing_input).val()},searching_value_timeout=$(typing_input).val(),$("#single_select_lucky").html(""),$.ajax({url:base_request_url+"/admin/luckySpin",type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$(e.dataArr).each(function(e,t){$("#single_select_lucky").append("<option value='"+t.id+"'> "+t.name+"</option>")}),load_autocomplete_component(),$("#single_select_lucky").select2("open"),$($(".select2-search__field")[0]).val(searching_value_timeout)},error:function(e){console.log("error"),console.log(e.error())}})},doneTypingInterval)}))}),$(".js-btn-set-scaling-classes").on("click",function(){$("#select2-multiple-input-sm, #select2-single-input-sm").next(".select2-container--bootstrap").addClass("input-sm"),$("#select2-multiple-input-lg, #select2-single-input-lg").next(".select2-container--bootstrap").addClass("input-lg"),$(this).removeClass("btn-primary btn-outline").prop("disabled",!0)})},$(".btn_add_new_item").click(function(){$("#modal_add_edit .modal-title").html("Create new "+item_name),$("#modal_add_edit input:text").val(""),$("#modal_add_edit .txt_add_edit_item_award").val(1),$("#modal_add_edit textarea").val(""),$(".select_status option").filter(function(){return"active"==$.trim($(this).val())}).prop("selected",!0),$(".select_status").selectpicker("refresh"),$(".select_status button").css("background-color","#32c5d2"),$(".select_daily option").filter(function(){return"false"==$.trim($(this).val())}).prop("selected",!0),$(".select_daily").selectpicker("refresh"),$("#modal_add_edit .btn_modal_save_new").show(),$("#modal_add_edit .btn_modal_save_update").hide(),$("#modal_add_edit").modal("show")}),$(".btn_confirm_yes").click(function(){$.ajax({url:base_request_url+"/admin/mission?missionId="+deleted_id,type:"DELETE",contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(){$("#modal_confirm").modal("hide"),_send_info.data={},page_datatable.ajax.reload(),$("#modal_add_edit").modal("hide"),show_toast_notif("success","Successfully","Deleted: '"+deleted_obj.name+"'",function(){})},error:function(e){show_toast_notif("error","Error","'"+e.responseText+"'",function(){})}})}),$(".btn_modal_save_new").click(function(){if(""!=$(".txt_add_edit_item_name").val())if($(".txt_add_edit_item_desc").val().length>200)show_toast_notif("error","Unable to create "+item_name,item_name+", description length must < 200 characters");else{switch($("#single_select_action").val()){case 1:if(""==$("#single_select_lucky").val())return void show_toast_notif("error","Unable to create "+item_name,"Phải chọn lucky spin");break;case 6:if(""==$("#link_share").val())return void show_toast_notif("error","Unable to create "+item_name,"Phải điền link để share")}var e=getDataAction(),t=e[0],a=e[1];_send_info.data={missionName:$(".txt_add_edit_item_name").val(),description:$(".txt_add_edit_item_desc").val(),action:$("#single_select_action").val(),objectId:t,objectValue:a,linkToShare:$("#link_share").val(),typeLimit:$("#single_select_limit").val(),valueLimit:$(".value_limit_award").val(),award:$("#single_select_type_award").val(),spinAwardId:$("#select_spin_award").val(),valueAward:$(".txt_add_edit_item_award").val(),fromDate:1e3*new moment($(".txt_add_edit_item_from_date").val(),"YYYY-MMMM-D HH:mm").unix(),toDate:1e3*new moment($(".txt_add_edit_item_to_date").val(),"YYYY-MMMM-D HH:mm").unix(),cyclic:$(".select_daily option:selected").val(),defaultImage:"default",status:$(".select_status option:selected").val(),highLights:$("[name='my-checkbox']").bootstrapSwitch("state")},$(".loading_icon").show(),$.ajax({url:base_request_url+"/admin/mission",type:"POST",data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){page_datatable.ajax.reload(null,!1),"01"==e.status?(show_toast_notif("success","Successfully","Created '"+$(".txt_add_edit_item_name").val()+"'",function(){}),importCard(e.data),$("#modal_add_edit").modal("hide")):show_toast_notif("error","Fail",e.message,function(){}),$(".loading_icon").hide()},error:function(e){show_toast_notif("error","Fail","Error '"+e.responseText+"'",function(){}),$(".loading_icon").hide()}})}else show_toast_notif("error","Unable to create "+item_name,item_name+" name is required")}),$(".btn_modal_save_update").click(function(){if(""!=$(".txt_add_edit_item_name").val())if($(".txt_add_edit_item_desc").val().length>200)show_toast_notif("error","Unable to update "+item_name,item_name+", description length must < 200 characters");else{switch($("#single_select_action").val()){case 1:if(""==$("#single_select_lucky").val())return void show_toast_notif("error","Unable to create "+item_name,"Phải chọn lucky spin");break;case 6:if(""==$("#link_share").val())return void show_toast_notif("error","Unable to create "+item_name,"Phải điền link để share")}var e=getDataAction(),t=e[0],a=e[1];_send_info.data={missionId:editing_item,missionName:$(".txt_add_edit_item_name").val(),description:$(".txt_add_edit_item_desc").val(),action:$("#single_select_action").val(),objectId:t,objectValue:a,linkToShare:$("#link_share").val(),typeLimit:$("#single_select_limit").val(),valueLimit:$(".value_limit_award").val(),award:$("#single_select_type_award").val(),spinAwardId:$("#select_spin_award").val(),valueAward:$(".txt_add_edit_item_award").val(),fromDate:1e3*new moment($(".txt_add_edit_item_from_date").val(),"YYYY-MMMM-D HH:mm").unix(),toDate:1e3*new moment($(".txt_add_edit_item_to_date").val(),"YYYY-MMMM-D HH:mm").unix(),cyclic:$(".select_daily option:selected").val(),defaultImage:"default",status:$(".select_status option:selected").val(),highLights:$("[name='my-checkbox']").bootstrapSwitch("state")},$(".loading_icon").show(),$.ajax({url:base_request_url+"/admin/mission",type:"PUT",data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){page_datatable.ajax.reload(null,!1),"01"==e.status?(importCard(e.data),show_toast_notif("success","Successfully","Updated '"+$(".txt_add_edit_item_name").val()+"'",function(){}),$("#modal_add_edit").modal("hide")):show_toast_notif("error","Fail",e.message,function(){}),$(".loading_icon").hide()},error:function(e){console.log(_send_info.data),show_toast_notif("error","Fail","Error '"+e.responseText+"'",function(){}),$(".loading_icon").hide()}})}else show_toast_notif("error","Unable to update "+item_name,item_name+" name is required")}),$(".select_status").change(function(){""!=$(this).val()&&("active"==$(this).val()?$(".select_status button").css("background-color","#32c5d2"):"inactive"==$(this).val()&&$(".select_status button").css("background-color","red"),$(".hidden_item_status").val($(this).val()))}),$(".search_submit").click(function(){search_value=$(".search_input").val(),page_datatable.ajax.reload(null,!1)}),$(".search_clear").click(function(){$(".search_input").val(""),search_value="",page_datatable.ajax.reload(null,!1)}),$(".form_datetime").datetimepicker({autoclose:!0,todayBtn:!0,isRTL:App.isRTL(),format:"yyyy-MM-dd hh:ii",pickerPosition:App.isRTL()?"top-right":"top-left"}),_send_info.data={limit:1e3,offset:0},$.ajax({url:base_request_url+"/admin/luckySpin",type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$(e.dataArr).each(function(e,t){$("#single_select_lucky").append("<option value='"+t.id+"'> "+t.name+"</option>"),$("#select_spin_award").append("<option value='"+t.id+"'> "+t.name+"</option>")}),load_autocomplete_component()},error:function(e){console.log(e.error())}}),$.ajax({url:base_request_url+"/admin/auction",type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$(e.dataArr).each(function(e,t){$("#single_select_auction").append("<option value='"+t.id+"'> "+t.name+"</option>")}),load_autocomplete_component()},error:function(e){console.log(e.error())}}),$.ajax({url:base_request_url+"/admin/giftcodeEvent",type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$(e.dataArr).each(function(e,t){$("#single_select_giftcode").append("<option value='"+t.giftcodeEvent.id+"'> "+t.keyName+"</option>")}),load_autocomplete_component()},error:function(e){console.log(e.error())}}),$.ajax({url:base_request_url+"/admin/splayGame",type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$(e.data).each(function(e,t){$("#single_select_game").append("<option value='"+t.scoinGameId+"'> "+t.name+"</option>")}),load_autocomplete_component()},error:function(e){console.log(e.error())}})};$("#txt_add_edit_giftcode_file").change(function(){$(".txt_add_edit_giftcode_info").text(this.files[0].name)});