var _current_page=1;_per_page=100;var search_value="";$(document).ready(function(){function e(e){$("body").excelexportjs({datatype:"json",dataset:e,columns:getColumns(e)})}var a=function(){$(".loading_icon").show(),void 0!=getUrlParameter("id")&&(event_id=getUrlParameter("id")),page_datatable=$("#page_datatable").DataTable({ajax:{url:base_request_url+"/admin/timelineReportGiftcode?giftcodeId="+event_id,type:"GET",data:function(e){null!=search_value&&""!=search_value&&(e.searchValue=search_value),e.limit=_per_page,e.offset=_per_page*(_current_page-1)},contentType:"application/json",dataType:"json",dataSrc:function(e){var a=0;if($(".datatable_paging").html(""),e.totalRecords>_per_page)for(a=1;a<=Math.ceil(e.totalRecords/_per_page);a++)a==_current_page?$(".datatable_paging").append("<span class='datatable_paging_number_active' page="+a+">"+a+"</span>"):1!=a&&a!=Math.ceil(e.totalRecords/_per_page)&&a!=_current_page-1&&a!=_current_page-2&&a!=_current_page+2&&a!=_current_page+1||(1==a&&_current_page>4?($(".datatable_paging").append("<span class='datatable_paging_number' page="+a+">"+a+"</span>"),$($(".datatable_paging_number")[0]).after("<span class='paging_truncate'>...</span>")):a==Math.ceil(e.totalRecords/_per_page)&&_current_page<Math.ceil(e.totalRecords/_per_page)-3?($(".datatable_paging").append("<span class='datatable_paging_number' page="+a+">"+a+"</span>"),$($(".datatable_paging_number")[$(".datatable_paging_number").length-1]).before("<span class='paging_truncate'>...</span>")):$(".datatable_paging").append("<span class='datatable_paging_number' page="+a+">"+a+"</span>"));else $(".datatable_paging").html("<span class='datatable_paging_number_active' page=1>1</span>");if($(".datatable_paging_number").click(function(e){_current_page=parseInt($(e.target).attr("page")),page_datatable.ajax.reload()}),$(".loading_icon").hide(),null!=e.dataArr){var t=[],n=[],r=[],i=[],o=[];getSetting(_setting_data,"date_format");return $(e.dataArr).each(function(e,a){var l=moment.unix(a.onDate/1e3).format("YYYY-MMMM-D");t.push(l),n.push(a.numberInstall),r.push(a.numberShareFacebook),i.push(a.numberGiftcodeLost),o.push(a.numberNRU)}),t=t.reverse(),n=n.reverse(),r=r.reverse(),i=i.reverse(),o=o.reverse(),$("#lineChart1").highcharts({chart:{style:{fontFamily:"Open Sans"}},title:{text:"Giftcode",x:-20},subtitle:{text:"Event: "+event_id,x:-20},xAxis:{categories:t},yAxis:{title:{text:""},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{valueSuffix:""},credits:{enabled:!1},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},exporting:{enabled:!1},series:[{name:"Install",data:n},{name:"Share Facebook",data:r},{name:"Giftcode RNU",data:o},{name:"Giftcode Lost",data:i}]}),e.dataArr}return[]},beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},error:function(e,a,t){"invalid_token"==JSON.parse(e.responseText).error&&(localStorage.removeItem("user_data"),document.location.replace("login"))}},columns:[{title:"Date",data:null,render:function(e,a,t,n){var r="",i=getSetting(_setting_data,"date_format");return r=moment.unix(t.onDate/1e3).format(i.value)}},{title:"Install",data:"numberInstall"},{title:"Share Facebook",data:"numberShareFacebook"},{title:"RNU",data:"numberNRU"},{title:"Giftcode Lost",data:"numberGiftcodeLost"}],aoColumnDefs:[{sWidth:"20%",aTargets:[0]},{sWidth:"10%",aTargets:[1]},{sWidth:"10%",aTargets:[2]},{sWidth:"10%",aTargets:[3]},{sWidth:"10%",aTargets:[4]}],autoWidth:!1,lengthChange:!1,info:!1,bSort:!1,bFilter:!1,bPaginate:!1,fnDrawCallback:function(e){$("div.dataTables_wrapper div.dataTables_filter label").contents().filter(function(){return 1!=this.nodeType}).replaceWith("")}})};$(".export_button").click(function(){$(".loading_icon").show(),$.ajax({url:base_request_url+"/admin/timelineReportGiftcode?giftcodeId="+event_id,type:"GET",data:function(e){return e.limit=1e5,e.offset=0,e},contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(a){console.log(a);var t=[];$.each(a.dataArr,function(e,a){var n=getSetting(_setting_data,"date_format");str_date=moment.unix(a.onDate/1e3).format(n.value),t.push({"Date time":str_date,Install:a.numberInstall,"Share FB":a.numberShareFacebook,Delivered:a.numberGiftcodeLost,NRU:a.numberNRU})}),e(t),$(".loading_icon").hide()},error:function(e){show_toast_notif("error","Fail","Error '"+e.responseText+"'"),$(".loading_icon").hide()}})}),a()});