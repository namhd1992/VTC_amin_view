function str_pad(e){return String("00"+e).slice(-2)}function objectifyForm(e){for(var t={},a=0;a<e.length;a++)t[e[a].name]=e[a].value;return t}var editing_item=null,item_name="Spin Item",item_names="Spin Items",deleted_id=null,channel_arr=[],search_value=null,page_datatable=null,deleted_obj=null,linkImage=null,flagNewImage=!1,imageCarosel=null;_current_page=1;var Page_script={init:function(){}},load_page=function(){function e(){if(flagNewImage){var e=new FormData;e.append("image",imageCarosel),$.ajax({url:base_request_url+"/admin/uploadImage",type:"POST",data:e,cache:!1,async:!1,contentType:!1,timeout:3e6,processData:!1,beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){"01"==e.status?(console.log(e),linkImage=e.data,t()):show_toast_notif("error","Fail","Upload Image Unsuccess")},error:function(e){show_toast_notif("error","Fail","Error '"+e.message+"'")}})}}function t(){flagNewImage&&(_send_info.data={urlImage:$("#link_image_text").html()},$.ajax({url:base_request_url+"/admin/deleteImage",type:"POST",data:JSON.stringify(_send_info.data),cache:!1,async:!1,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){page_datatable.ajax.reload(null,!1),"01"==e.status?(console.log(e),show_toast_notif("success","Successfully","Add new and Delete old image success")):show_toast_notif("error","Fail","Upload Image Unsuccess")},error:function(e){show_toast_notif("error","Fail","Error '"+e.message+"'")}}))}_send_info.data={limit:_per_page,offset:_per_page*(_current_page-1)},$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"});page_datatable=$("#page_datatable").DataTable({ajax:{url:base_request_url+"/admin/adminItemOfSpin",type:"GET",data:function(e){null!=search_value&&""!=search_value&&(e.searchValue=search_value),e.limit=_per_page,e.offset=_per_page*(_current_page-1)},contentType:"application/json",dataType:"json",dataSrc:function(e){var t=0;if($(".datatable_paging").html(""),e.totalRecords>_per_page)for(t=1;t<=Math.ceil(e.totalRecords/_per_page);t++)t==_current_page?$(".datatable_paging").append("<span class='datatable_paging_number_active' page="+t+">"+t+"</span>"):1!=t&&t!=Math.ceil(e.totalRecords/_per_page)&&t!=_current_page-1&&t!=_current_page-2&&t!=_current_page+2&&t!=_current_page+1||(1==t&&_current_page>4?($(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"),$($(".datatable_paging_number")[0]).after("<span class='paging_truncate'>...</span>")):t==Math.ceil(e.totalRecords/_per_page)&&_current_page<Math.ceil(e.totalRecords/_per_page)-3?($(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"),$($(".datatable_paging_number")[$(".datatable_paging_number").length-1]).before("<span class='paging_truncate'>...</span>")):$(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"));else $(".datatable_paging").html("<span class='datatable_paging_number_active' page=1>1</span>");return $(".datatable_paging_number").click(function(e){_current_page=parseInt($(e.target).attr("page")),page_datatable.ajax.reload()}),null!=e.dataArr?e.dataArr:[]},beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},error:function(e,t,a){"invalid_token"==JSON.parse(e.responseText).error&&(localStorage.removeItem("user_data"),document.location.replace("login"))}},columns:[{title:"ID",data:"id"},{title:"Name",data:"name"},{title:"Status",data:null,render:function(e,t,a,i){return e="active"==a.status?"<div class='active_status'>"+a.status+"</div>":"<div class='inactive_status'>"+a.status+"</div>",e}},{title:"Type",data:"type"},{title:"Big Item",data:null,render:function(e,t,a,i){return e=1==a.bigItem?"<div class='inactive_status'>Yes</div>":"<div class='active_status'>No</div>",e}},{title:"Quantity",data:null,render:function(e,t,a,i){var n=a.quantity;return a.quantity<0&&(n="Unlimited"),n}},{title:"Action",data:null,render:function(e,t,a,i){var n="";return n+="<a class='btn_edit_item' item_id='"+a.id+"' item_obj='"+JSON.stringify(a)+"'><i class='icon-wrench'></i> Edit </a>",n+="<a class='btn_delete_item' item_id='"+a.id+"' item_obj='"+JSON.stringify(a)+"'><i class='icon-trash'></i> Delete </a>",n}}],aoColumnDefs:[{sWidth:"2%",aTargets:[0]},{sWidth:"20%",aTargets:[1]},{sWidth:"5%",aTargets:[2]},{sWidth:"5%",aTargets:[3]},{sWidth:"5%",aTargets:[4]},{sWidth:"5%",aTargets:[5]},{sWidth:"15%",aTargets:[6]}],autoWidth:!1,lengthChange:!1,info:!1,bSort:!1,bFilter:!1,bPaginate:!1,fnDrawCallback:function(e){$("div.dataTables_wrapper div.dataTables_filter label").contents().filter(function(){return 1!=this.nodeType}).replaceWith(""),$(".btn_edit_item").click(function(){var e=JSON.parse($(this).attr("item_obj"));console.log(e),editing_item=e.id,$("#modal_add_edit input:file").val(""),$("#link_image_text").html(""),$("#modal_add_edit .modal-title").html("Edit "+item_name+" "+e.name),$("#modal_add_edit .txt_add_edit_item_name").val(e.name),$("#modal_add_edit .txt_add_edit_item_wheel_title").val(e.wheelTitle),$("#modal_add_edit .txt_add_edit_item_winning_title").val(e.winningTitle),$("#modal_add_edit .txt_add_edit_item_value").val(e.value),$("#review_image_text").attr("src",e.urlImage),$("#link_image_text").html(e.urlImage),$("#modal_add_edit .txt_add_edit_item_description").val(e.description),$("#modal_add_edit .hidden_item_is_default").val(e.isDefault),$("#modal_add_edit .hidden_item_type").val(e.type),$("#modal_add_edit .txt_add_edit_item_quantity").val(e.quantity),1==e.isDefault?($(".txt_add_edit_item_default_pos").parent().parent().show(),$(".txt_add_edit_item_default_pos").attr("name","defaultPosition"),$(".txt_add_edit_item_default_pos").val(e.defaultPosition),$(".txt_add_edit_item_default_ratio").parent().parent().show(),$(".txt_add_edit_item_default_ratio").attr("name","defaultRatio"),$(".txt_add_edit_item_default_ratio").val(100*e.defaultRatio)):($(".txt_add_edit_item_default_pos").parent().parent().hide(),$(".txt_add_edit_item_default_pos").attr("name",""),$(".txt_add_edit_item_default_ratio").parent().parent().hide(),$(".txt_add_edit_item_default_ratio").attr("name","")),$(".select_type").val(e.type),$(".select_big_item").val(String(e.bigItem)),console.log('$(".select_big_item").val == ',$(".select_big_item").val()),$(".select_incre option").filter(function(){return $.trim($(this).val())==String(e.increPerDay)}).prop("selected",!0),$(".select_incre").selectpicker("refresh"),$(".hidden_id").remove(),$("#add_giftcode_form").append("<input type='hidden' class='hidden_id' name='itemId' value='"+e.id+"' />"),$("#modal_add_edit .btn_modal_save_new").hide(),$("#modal_add_edit .btn_modal_save_update").show(),jQuery(".select_status option").filter(function(){return $.trim($(this).val())==e.status}).prop("selected",!0),$(".select_status").selectpicker("refresh"),"active"==e.status?$(".select_status button").css("background-color","#32c5d2"):$(".select_status button").css("background-color","red"),1==e.highLights?$("[name='highlights']").bootstrapSwitch("state",":checked"):$("[name='highlights']").bootstrapSwitch("state",""),$(".btn_delete_item").show(),$(".btn_delete_item").attr("item_id",e.id),$("#modal_add_edit").modal("show")}),$(".btn_delete_item").click(function(){var e=JSON.parse($(this).attr("item_obj"));deleted_obj=e,deleted_id=e.id,$("#modal_confirm").modal("show")})}});$(".btn_add_new_item").click(function(){$("#add_giftcode_form").trigger("reset"),channel_arr=[],_user_data.data.groupRole.id,$("#modal_add_edit .btn_modal_save_new").show(),$("#modal_add_edit .btn_modal_save_update").hide(),$(".hidden_giftcode_id").remove(),$("#modal_add_edit").modal("show")}),$(".date-picker").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0}),$(".btn_confirm_yes").click(function(){$.ajax({url:base_request_url+"/admin/adminItemOfSpin?itemId="+deleted_id,type:"DELETE",contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(){$("#modal_confirm").modal("hide"),_send_info.data={},page_datatable.ajax.reload(),$("#modal_add_edit").modal("hide"),show_toast_notif("success","Successfully","Deleted: '"+deleted_obj.name+"'",function(){})},error:function(e){show_toast_notif("error","Error","'"+e.responseText+"'",function(){})}})}),$(".btn_modal_save_new").click(function(){if(""!=$(".txt_add_edit_item_name").val())if(0!=$(".txt_add_edit_item_quantity").val())if("giftcode"!=$(".hidden_item_type").val()||""!=$(".file_add_edit_item_giftcode").val()){$("#add_giftcode_form").attr("enctype","multipart/form-data");var e=new FormData($("#add_giftcode_form")[0]);e.defaultRatio=parseFloat(e.defaultRatio)/100,e.highLights=$("#my-checkbox").bootstrapSwitch("state"),e.urlImage=$("#link_image_text").html(),$(".loading_icon").show(),$.ajax({url:base_request_url+"/admin/adminItemOfSpin",type:"POST",data:e,cache:!1,contentType:!1,processData:!1,beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){page_datatable.ajax.reload(null,!1),"T"==e.statusCode?(show_toast_notif("success","Successfully","Created '"+$(".txt_add_edit_item_name").val()+"'",function(){}),$("#modal_add_edit").modal("hide")):show_toast_notif("error","Fail",e.onlyMessage,function(){}),$(".loading_icon").hide()},error:function(e){show_toast_notif("error","Fail","Error '"+e.responseText+"'",function(){}),$(".loading_icon").hide()}})}else show_toast_notif("error","Unable to update item","Giftcode file is require",function(){});else show_toast_notif("error","Unable to create item","Quantity must greater than 0",function(){});else show_toast_notif("error","Unable to create Item","Item name is required")}),$(".btn_modal_save_update").click(function(){if($("#add_giftcode_form").removeAttr("enctype"),""!=$(".txt_add_edit_item_name").val()){var e=objectifyForm($($("#add_giftcode_form")[0]).serializeArray());e.defaultRatio=parseFloat(e.defaultRatio)/100,e.highLights=$("#my-checkbox").bootstrapSwitch("state"),e.urlImage=$("#link_image_text").html(),$(".loading_icon").show(),$.ajax({url:base_request_url+"/admin/adminItemOfSpin",type:"PUT",data:JSON.stringify(e),contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){page_datatable.ajax.reload(null,!1),"T"==e.statusCode?(show_toast_notif("success","Successfully","Updated '"+$(".txt_add_edit_item_name").val()+"'",function(){}),$("#modal_add_edit").modal("hide")):show_toast_notif("error","Fail",e.onlyMessage,function(){}),$(".loading_icon").hide()},error:function(e){show_toast_notif("error","Fail","Error '"+e.responseText+"'",function(){}),$(".loading_icon").hide()}})}else show_toast_notif("error","Unable to update item","Item name is required",function(){})}),$("#txt_add_edit_image_text").change(function(){linkImage=null,flagNewImage=!1,imageCarosel=null;var e=this.files[0];(e="image/jpeg"==e.type||"image/png"==e.type||"image/jpg"==e.type||"image/gif"==e.type)?($("#review_image_text").attr("src",URL.createObjectURL(this.files[0])),imageCarosel=this.files[0],flagNewImage=!0):show_toast_notif("error","Error","Không Đúng Định Dạng Ảnh",function(){})}),$("#upload_image_text").click(function(){$(".loading_icon").show(),e(),$(".loading_icon").hide(),null!=linkImage?$("#link_image_text").html(linkImage):show_toast_notif("error","Error","Upload ảnh xảy ra lỗi",function(){})}),$(".select_status").change(function(){""!=$(this).val()&&("active"==$(this).val()?$(".select_status button").css("background-color","#32c5d2"):"inactive"==$(this).val()&&$(".select_status button").css("background-color","red"),$(".hidden_item_status").val($(this).val()))}),$(".select_type").change(function(){""!=$(this).val()&&("GIFTCODE"==$(this).val()?($(".form-up-giftcode").show(),$(".file_add_edit_item_giftcode").attr("name","giftCodeFile"),$(".form-quantity").hide(),$(".txt_add_edit_item_quantity").attr("name",""),$(".txt_add_edit_item_value").hide(),$(".txt_add_edit_item_value").attr("name","")):($(".form-up-giftcode").hide(),$(".file_add_edit_item_giftcode").attr("name",""),$(".form-quantity").show(),$(".txt_add_edit_item_quantity").attr("name","quantity"),$(".txt_add_edit_item_value").parent().parent().show(),$(".txt_add_edit_item_value").attr("name","value")),$(".hidden_item_type").val($(this).val()))}),$(".area_add_edit_item_desc").keydown(function(){$(".character_left").html(200-parseInt($(this).val().length)),200-parseInt($(this).val().length)<0?$(".character_left").css("color","red"):$(".character_left").css("color","green")}),$(".search_submit").click(function(){search_value=$(".search_input").val(),page_datatable.ajax.reload(null,!1)}),$(".search_clear").click(function(){$(".search_input").val(""),search_value="",page_datatable.ajax.reload(null,!1)})};jQuery(document).ready(function(){Page_script.init(),load_page(),$("[name='highlights']").bootstrapSwitch()});