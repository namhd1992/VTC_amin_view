function str_pad(e){return String("00"+e).slice(-2)}var editing_item=null,item_name="Event Game",item_names="Games",deleted_id=null,search_value=null,page_datatable=null,deleted_obj=null,load_autocomplete_component=null;_current_page=1;var typingTimer,doneTypingInterval=500,searching_value_timeout="",listItems=[],itemChange=[],itemRemove=[],Page_script={init:function(){}};_send_info.data={limit:1e3,offset:0};var load_page=function(){function e(e,t){var a="";$(".txt_add_edit_package_gift").each(function(){if(""==$(this).val()||0==$(this).val())$(this).parent().remove();else{var e=$(this).val();e=e.replace(".",""),a+=e+","}}),itemChange=[],$.each($(".detail_items"),function(){var e=$(this).children().next().next(),t={id:e.children().next().val(),newPrice:e.children().val()};itemChange.push(t)}),itemRemove=[],$.each($(".remove_items"),function(){$(this).children().next().next();itemRemove.push($(this).children().next().next().children().next().val())}),$.each(itemChange,function(e,t){$.each(itemRemove,function(e,a){t.id==a&&itemRemove.splice(e,1)})}),console.log("itemChange",itemChange),console.log("itemRemove",itemRemove),_send_info.data={id:t,name:$(".txt_add_edit_item_name").val(),serviceId:$(".txt_add_edit_service_id").val(),urlBaseEvent:$(".txt_add_edit_base_url").val(),giftEvent:$("#single_select_type_award option:selected").val(),oncePoint:$(".txt_add_edit_once_point").val(),ratioGift:$(".ratio_gift").val(),packageGift:a.slice(0,-1),limitGift:$(".value_limit_award").val(),gaveGift:$(".txt_add_edit_gift_lost").val(),playTutorial:CKEDITOR.instances.tutorial.getData(),fromDate:1e3*new moment($(".txt_add_edit_item_from_date").val(),"YYYY-MM-D").unix(),toDate:1e3*new moment($(".txt_add_edit_item_to_date").val(),"YYYY-MM-D").unix(),status:$(".select_status option:selected").val(),itemUpdates:itemChange,itemRemoveIds:itemRemove},"SHOPING"==$("#single_select_type_award option:selected").val()&&(_send_info.data.packageGift=0),console.log(_send_info.data),$(".loading_icon").show(),$.ajax({url:base_request_url+e,type:"POST",data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){page_datatable.ajax.reload(null,!1),"01"==e.status?(show_toast_notif("success","Successfully","Updated '"+$(".txt_add_edit_item_name").val()+"'",function(){}),$("#modal_add_edit").modal("hide")):show_toast_notif("error","Fail",e.message,function(){}),$(".loading_icon").hide()},error:function(e){console.log(_send_info.data),show_toast_notif("error","Fail","Error '"+e.responseText+"'",function(){}),$(".loading_icon").hide()}})}CKEDITOR.replace("tutorial"),_send_info.data={limit:_per_page,offset:_per_page*(_current_page-1)},$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"}),page_datatable=$("#page_datatable").DataTable({ajax:{url:base_request_url+"/admin/event-game/get",type:"GET",data:function(e){null!=search_value&&""!=search_value&&(e.searchValue=search_value),e.limit=_per_page,e.offset=_per_page*(_current_page-1)},contentType:"application/json",dataType:"json",dataSrc:function(e){console.log(e);var t=0;if($(".datatable_paging").html(""),e.totalRecords>_per_page)for(t=1;t<=Math.ceil(e.totalRecords/_per_page);t++)t==_current_page?$(".datatable_paging").append("<span class='datatable_paging_number_active' page="+t+">"+t+"</span>"):1!=t&&t!=Math.ceil(e.totalRecords/_per_page)&&t!=_current_page-1&&t!=_current_page-2&&t!=_current_page+2&&t!=_current_page+1||(1==t&&_current_page>4?($(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"),$($(".datatable_paging_number")[0]).after("<span class='paging_truncate'>...</span>")):t==Math.ceil(e.totalRecords/_per_page)&&_current_page<Math.ceil(e.totalRecords/_per_page)-3?($(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"),$($(".datatable_paging_number")[$(".datatable_paging_number").length-1]).before("<span class='paging_truncate'>...</span>")):$(".datatable_paging").append("<span class='datatable_paging_number' page="+t+">"+t+"</span>"));else $(".datatable_paging").html("<span class='datatable_paging_number_active' page=1>1</span>");return $(".datatable_paging_number").click(function(e){_current_page=parseInt($(e.target).attr("page")),page_datatable.ajax.reload()}),null!=e.data?e.data:[]},beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},error:function(e,t,a){"invalid_token"==JSON.parse(e.responseText).error&&(localStorage.removeItem("user_data"),document.location.replace("login"))}},responsive:!0,columns:[{title:"ID",data:"id"},{title:"Name",data:"name"},{title:"Event Type",data:"eventType"},{title:"Gift Lost",data:"gaveGift"},{title:"Status",data:null,render:function(e,t,a,i){return e=1==a.status?"<div class='active_status'> Active </div>":"<div class='inactive_status'> Inactive </div>",e}},{title:"Create On",data:null,render:function(e,t,a,i){var n=moment(a.createOn).format("YYYY-MMMM-D HH:mm");return n}},{title:"Action",data:null,render:function(e,t,a,i){var n="";return n+="<a class='btn_edit_item' item_id='"+a.id+"' item_obj='"+JSON.stringify(a)+"'><i class='icon-wrench'></i> Edit </a>",n+="<a class='btn_delete_item' item_id='"+a.id+"' item_obj='"+JSON.stringify(a)+"'><i class='icon-trash'></i> Delete </a>",n}}],aoColumnDefs:[{responsivePriority:1,sWidth:"2%",aTargets:[0]},{responsivePriority:2,sWidth:"20%",aTargets:[1]},{responsivePriority:2,sWidth:"10%",aTargets:[2]},{responsivePriority:2,sWidth:"10%",aTargets:[3]},{responsivePriority:2,sWidth:"10%",aTargets:[4]},{responsivePriority:2,sWidth:"10%",aTargets:[5]},{responsivePriority:1,sWidth:"10%",aTargets:[6]}],autoWidth:!0,lengthChange:!0,info:!1,bSort:!0,bFilter:!1,bPaginate:!1,fnDrawCallback:function(e){$(".btn_edit_item").click(function(){var e=JSON.parse($(this).attr("item_obj"));editing_item=e.id,eventGame=e,$("#modal_add_edit .modal-title").html("Edit "+eventGame.name),$(".txt_add_edit_item_name").val(eventGame.name),$("#select_event_type").val(eventGame.eventType),$("#single_select_game").val(eventGame.serviceId),void 0!==CKEDITOR.instances.tutorial&&CKEDITOR.instances.tutorial.destroy(),CKEDITOR.replace("tutorial"),CKEDITOR.instances.tutorial.setData(eventGame.playTutorial);var t=getSetting(_setting_data,"date_format");$(".txt_add_edit_item_from_date").val(moment.unix(eventGame.fromDate/1e3).format(t.value)),$(".txt_add_edit_item_to_date").val(moment.unix(eventGame.toDate/1e3).format(t.value)),$("#modal_add_edit .btn_modal_save_new").hide(),$("#modal_add_edit .btn_modal_save_update").show(),$("#modal_add_edit").modal("show"),$(".detail_items , .button_add_item").remove(),$.each(e.itemEvents,function(t,a){var i=t+1,n="";n+='<div class="form-group detail_items">',n+='<div class="col-xs-1" style="margin-left: 110px;">'+i+"</div>",n+='<div class="col-xs-5" id="item_name">'+a.item.name+"</div>",n+='<div class="col-xs-3">',n+='<input type="number" class="item_price form-control" min="1" placeholder="Price" value="'+a.item.price+'">',n+='<input type="hidden" class="item_id" value="'+a.item.id+'" />',n+="</div>",n+='<div class="col-sx-1"><a class="btn btn-icon-only red btn_delete_item"><i class="fa fa-remove"></i></a></div>',n+="</div>",t==e.itemEvents.length-1&&(n+='<div class="col-xs-9 button_add_item"><a style="width:20%;margin-left:378px;font-size:17px;" class="btn btn-icon-only green btn_add_more_item"><i class="fa fa-plus"></i></a></div>'),$(".item_group").append(n),$(".btn_delete_item").click(function(){$(this).parent().parent().hide(),$(this).parent().parent().addClass("remove_items"),$(this).parent().parent().removeClass("detail_items")}),$(".btn_add_more_item").click(function(){var e="";e+='<div class="form-group detail_items">',e+='<div class="col-xs-1" style="margin-left: 110px;"></div>',e+='<div class="col-xs-5">',e+='<select class="form-control select_new_item select2">',null!=listItems&&(e+='<option value="0">Lựa Chọn Item</option>',$.each(listItems,function(t,a){e+='<option value="'+a.shopingItem.id+'">'+a.shopingItem.name+"</option>"})),e+="</select>",e+="</div>",e+='<div class="col-xs-3">',e+='<input type="number" class="item_price form-control" min="1" placeholder="Price">',e+='<input type="hidden" class="item_id" />',e+="</div>",e+='<div class="col-sx-1"><a class="btn btn-icon-only red btn_delete_item"><i class="fa fa-remove"></i></a></div>',e+="</div>",$(this).parent().before(e),$(".select_new_item").change(function(){$(this).parent().next().children().next().val($(this).val())}),$(".btn_delete_item").click(function(){$(this).parent().prev().children().next().val();$(this).parent().parent().remove()})})})}),$(".btn_delete_item").click(function(){var e=JSON.parse($(this).attr("item_obj"));deleted_obj=e,deleted_id=e.id,$("#modal_confirm").modal("show")})}}),$("#modal_add_edit .btn_modal_save_update").click(function(){e(URL_UPDATE_EVENT_GAME,editing_item)}),$(".btn_add_new_item").click(function(){$("#modal_add_edit .modal-title").html("Add new "+item_name),$("#add_edit_event_game_form").trigger("reset"),$(".txt_add_edit_package_gift").each(function(){1!=$(".txt_add_edit_package_gift").length?$(".txt_add_edit_package_gift").parent(".col-xs-3:last-child").remove():$(".txt_add_edit_package_gift").val("")}),$("#single_select_type_award").val("XU"),$("#modal_add_edit .btn_modal_save_new").show(),$("#modal_add_edit .btn_modal_save_update").hide(),$("#modal_add_edit").modal("show"),$("#modal_add_edit .btn_modal_save_new").click(function(){e(URL_CREATE_EVENT_GAME,null)})}),$(".btn_confirm_yes").click(function(){$.ajax({url:base_request_url+"/admin/event-game/delete?eventId="+deleted_id,type:"DELETE",contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(){$("#modal_confirm").modal("hide"),_send_info.data={},page_datatable.ajax.reload(),$("#modal_add_edit").modal("hide"),show_toast_notif("success","Successfully","Deleted: '"+deleted_obj.name+"'",function(){})},error:function(e){show_toast_notif("error","Error","'"+e.responseText+"'",function(){})}})}),$("#single_select_type_award").change(function(){"SHOPING"==$(this).val()?($(".form_item_group").show(),$(".form_package_gift").hide(),$(".ratio_gift").attr("disabled","disable"),$(".ratio_gift").val(1)):($(".form_item_group").hide(),$(".form_package_gift").show(),$(".ratio_gift").removeAttr("disabled"))}),$("#add_package_gift").click(function(){$(".parent_package_gift").append("<div class='col-xs-3'><input type='text' class='txt_add_edit_package_gift form-control' name='parkageGift'></div>")}),$("#remove_package_gift").click(function(){1!=$(".txt_add_edit_package_gift").length?$(".txt_add_edit_package_gift").parent(".col-xs-3:last-child").remove():$(".txt_add_edit_package_gift").val("")}),$("#reset_gift_lost").click(function(){$(".txt_add_edit_gift_lost").val(0)}),$("#single_select_limit").change(function(){""==$("#single_select_limit").val()?($(".value_limit_award").attr("disabled","disable"),$(".value_limit_award").val(0)):$(".value_limit_award").removeAttr("disabled")}),$("#single_select_game").change(function(){var e=$("#single_select_game").val();0!=e?$(".txt_add_edit_service_id").attr("disabled","disable"):$(".txt_add_edit_service_id").removeAttr("disabled"),console.log(e),$(".txt_add_edit_service_id").val(e)}),$.ajax({url:base_request_url+"/admin/splayGame",type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(e){$(e.data).each(function(e,t){$("#single_select_game").append("<option value='"+t.scoinGameId+"'> "+t.name+"</option>")})},error:function(e){console.log(e.error())}}),$(".form_datetime").datetimepicker({autoclose:!0,todayBtn:!0,isRTL:App.isRTL(),format:"yyyy-mm-dd hh:ii",pickerPosition:App.isRTL()?"bottom-right":"top-right"})};jQuery(document).ready(function(){Page_script.init(),load_page()});