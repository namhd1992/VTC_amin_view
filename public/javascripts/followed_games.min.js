var editing_item=null,item_name="Followed Game",item_names="Followed Games",deleted_id=null,channel_arr=[],page_datatable=null;_current_page=1;var search_value=null,Page_script=function(){return{init:function(){}}}(),load_page=function(){_send_info.data={limit:10,offset:0},$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"});var a=function(a){channel_arr.splice(channel_arr.indexOf(a),1)},e=function(a){var e=$("<input>");$("body").append(e),e.val(a).select(),document.execCommand("copy"),e.remove()},t=function(a){$(".android_package_item").append('<input type="text" class="txt_add_edit_android_package form-control extent_package" placeholder="Enter text" value="'+a+'">'),$(".android_package_item").append('<a class="btn btn-icon-only purple btn_rm_android_package extent_package"><i class="fa fa-times"></i></a>'),$(".btn_rm_android_package").click(function(){$(this).prev().remove(),$(this).remove()})},n=function(a){$(".ios_package_item").append('<input type="text" class="txt_add_edit_ios_package form-control extent_package" placeholder="Enter text" value="'+a+'">'),$(".ios_package_item").append('<a class="btn btn-icon-only purple btn_rm_ios_package extent_package"><i class="fa fa-times"></i></a>'),$(".btn_rm_ios_package").click(function(){$(this).prev().remove(),$(this).remove()})},i=function(){function e(a){if(a.loading)return a.text;var e="<div class='select2-result-repository clearfix'><div class='select2-result-repository__avatar'><img src='"+a.owner.avatar_url+"' /></div><div class='select2-result-repository__meta'><div class='select2-result-repository__title'>"+a.full_name+"</div>";return a.description&&(e+="<div class='select2-result-repository__description'>"+a.description+"</div>"),e+="<div class='select2-result-repository__statistics'><div class='select2-result-repository__forks'><span class='glyphicon glyphicon-flash'></span> "+a.forks_count+" Forks</div><div class='select2-result-repository__stargazers'><span class='glyphicon glyphicon-star'></span> "+a.stargazers_count+" Stars</div><div class='select2-result-repository__watchers'><span class='glyphicon glyphicon-eye-open'></span> "+a.watchers_count+" Watchers</div></div></div></div>"}function t(a){return a.full_name||a.text}$.fn.select2.defaults.set("theme","bootstrap");var n="Type to search";$(".select2, .select2-multiple").select2({placeholder:n,width:null}),$(".select2-allow-clear").select2({allowClear:!0,placeholder:n,width:null}),$(".js-data-example-ajax").select2({width:"off",ajax:{url:"https://api.github.com/search/repositories",dataType:"json",delay:250,data:function(a){return{q:a.term,page:a.page}},processResults:function(a,e){return{results:a.items}},cache:!0},escapeMarkup:function(a){return a},minimumInputLength:1,templateResult:e,templateSelection:t}),$("button[data-select2-open]").click(function(){$("#"+$(this).data("select2-open")).select2("open")}),$(":checkbox").on("click",function(){$(this).parent().nextAll("select").prop("disabled",!this.checked)}),$(".select2, .select2-multiple, .select2-allow-clear, .js-data-example-ajax").on("select2:open",function(){if($(this).parents("[class*='has-']").length)for(var a=$(this).parents("[class*='has-']")[0].className.split(/\s+/),e=0;e<a.length;++e)a[e].match("has-")&&$("body > .select2-container").addClass(a[e])}),$(".js-btn-set-scaling-classes").on("click",function(){$("#select2-multiple-input-sm, #select2-single-input-sm").next(".select2-container--bootstrap").addClass("input-sm"),$("#select2-multiple-input-lg, #select2-single-input-lg").next(".select2-container--bootstrap").addClass("input-lg"),$(this).removeClass("btn-primary btn-outline").prop("disabled",!0)}),$("#single_select").change(function(){$.inArray($("#single_select").val(),channel_arr)==-1&&(channel_arr.push($("#single_select").val()),$(".current_channels").append(" <span channel_id='"+$("#single_select").val()+"' class='tag label label-primary'><i class='fa fa-folder'></i> "+$("#single_select option:selected").text()+"<span class='remove_channel' data-role='remove'></span></span>"),$(".current_channels .remove_channel").click(function(){a($(this).parent().attr("channel_id")),$(this).parent().remove()}))})};_send_info.data={},$.ajax({url:base_request_url+"/admin/channel",type:"GET",data:_send_info.data,contentType:"application/json",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(a){$(a.dataArr).each(function(a,e){$("#single_select").append("<option value='"+e.id+"'> "+e.name+"</option>")}),i()},error:function(a){console.log(a.error())}}),page_datatable=$("#page_datatable").DataTable({ajax:{url:base_request_url+"/admin/package",type:"GET",data:function(a){a.limit=_per_page,a.offset=_per_page*(_current_page-1),null!=search_value&&(a.searchValue=search_value)},contentType:"application/json",dataType:"json",dataSrc:function(a){var e=0;if($(".datatable_paging").html(""),a.totalRecords>_per_page)for(e=1;e<=Math.ceil(a.totalRecords/_per_page);e++)e==_current_page?$(".datatable_paging").append("<span class='datatable_paging_number_active' page="+e+">"+e+"</span>"):1!=e&&e!=Math.ceil(a.totalRecords/_per_page)&&e!=_current_page-1&&e!=_current_page-2&&e!=_current_page+2&&e!=_current_page+1||(1==e&&_current_page>4?($(".datatable_paging").append("<span class='datatable_paging_number' page="+e+">"+e+"</span>"),$($(".datatable_paging_number")[0]).after("<span class='paging_truncate'>...</span>")):e==Math.ceil(a.totalRecords/_per_page)&&_current_page<Math.ceil(a.totalRecords/_per_page)-3?($(".datatable_paging").append("<span class='datatable_paging_number' page="+e+">"+e+"</span>"),$($(".datatable_paging_number")[$(".datatable_paging_number").length-1]).before("<span class='paging_truncate'>...</span>")):$(".datatable_paging").append("<span class='datatable_paging_number' page="+e+">"+e+"</span>"));else $(".datatable_paging").html("<span class='datatable_paging_number_active' page=1>1</span>");return $(".datatable_paging_number").click(function(a){_current_page=parseInt($(a.target).attr("page")),page_datatable.ajax.reload()}),a.dataArr},beforeSend:function(a){a.setRequestHeader("Authorization","bearer "+_user_data.access_token)},error:function(a,e,t){"invalid_token"==JSON.parse(a.responseText).error&&(localStorage.removeItem("user_data"),document.location.replace("login"))}},columns:[{title:"ID",data:"id"},{title:"Name",data:"name"},{title:"Android",data:null,render:function(a,e,t,n){var i="";return""!=t.packageAndroid&&null!=t.packageAndroid&&$(t.packageAndroid.split(",")).each(function(a,e){""!==e&&(i+="<div class='wrap_package_icon tooltip-top' title='Click to copy' data-tooltip='"+e+"'><i class='package_icon_icon fa fa-android'></i></div> ")}),i}},{title:"iOS",data:null,render:function(a,e,t,n){var i="";return""!=t.packageIOS&&null!=t.packageIOS&&$(t.packageIOS.split(",")).each(function(a,e){""!==e&&(i+="<div class='wrap_package_icon tooltip-top' title='Click to copy' data-tooltip='"+e+"'><i class='package_icon_icon fa fa-apple'></i></div> ")}),i}},{title:"News",data:null,render:function(a,e,t,n){return"<i class='fa fa-rss-square'></i> "+t.numberNews}},{title:"Channels",data:null,render:function(a,e,t,n){return"<i class='fa fa-folder'></i> "+t.numberChannel}},{title:"Status",data:null,render:function(a,e,t,n){return a="active"==t.status?"<div class='active_status'>"+t.status+"</div>":"<div class='inactive_status'>"+t.status+"</div>"}},{title:"Action",data:null,render:function(a,e,t,n){var i="";return i="<a class='btn_edit_item' item_id='"+t.id+"' item_obj='"+JSON.stringify(t)+"'><i class='icon-wrench'></i> Edit </a>",i+="<a class='btn_delete_item' item_id='"+t.id+"' item_obj='"+JSON.stringify(t)+"'><i class='icon-trash'></i> Delete </a>"}}],aoColumnDefs:[{sWidth:"5%",aTargets:[0]},{sWidth:"15%",aTargets:[1]},{sWidth:"15%",aTargets:[2]},{sWidth:"20%",aTargets:[3]},{sWidth:"5%",aTargets:[4]},{sWidth:"5%",aTargets:[5]},{sWidth:"5%",aTargets:[6]},{sWidth:"20%",aTargets:[7]}],autoWidth:!1,searching:!1,lengthChange:!1,info:!1,bSort:!1,bFilter:!1,bPaginate:!1,fnDrawCallback:function(i){$(".wrap_package_icon").click(function(){e($(this).attr("data-tooltip")),show_toast_notif("info","Copied to clipboard","Package name '"+$(this).attr("data-tooltip")+"'",function(){})}),$(".wrap_package_icon").mouseover(function(){$(this).find(".package_icon_text").show()}),$(".wrap_package_icon").mouseout(function(){$(this).find(".package_icon_text").hide()}),$(".btn_edit_item").click(function(){channel_arr=[];var e=JSON.parse($(this).attr("item_obj"));console.log(e),editing_item=e.id,$("#modal_add_edit .modal-title").html("Edit "+item_name+" "+e.name),$("#modal_add_edit .txt_add_edit_item_name").val(e.name),$("#modal_add_edit .txt_add_edit_android_download").val(e.urlDownloadAndroid),$("#modal_add_edit .txt_add_edit_ios_download").val(e.urlDownloadiOS),jQuery(".select_status option").filter(function(){return $.trim($(this).val())==e.status}).prop("selected",!0),$(".select_status").selectpicker("refresh"),"active"==e.status?$(".select_status button").css("background-color","#32c5d2"):$(".select_status button").css("background-color","red"),$(".current_channels").html(" "),null!=e.listChannels&&$.each(e.listChannels,function(a,e){$(".current_channels").append(" <span class='tag label label-primary'><i class='fa fa-folder'></i> "+e.name+"<span class='remove_channel' data-role='remove'></span></span>"),channel_arr.push(e.id)}),$(".current_channels .remove_channel").click(function(){a($(this).parent().attr("channel_id")),$(this).parent().remove()}),$(".extent_package").remove(),$(e.packageAndroid.split(",")).each(function(a,e){0===a&&$("#modal_add_edit .txt_add_edit_android_package").val(e),""!==e&&0!==a&&t(e)}),$(e.packageIOS.split(",")).each(function(a,e){0===a&&$("#modal_add_edit .txt_add_edit_ios_package").val(e),""!==e&&0!==a&&n(e)}),$("#modal_add_edit").modal("show"),$("#modal_add_edit .btn_modal_save_new").hide(),$("#modal_add_edit .btn_modal_save_update").show()}),$(".btn_delete_item").click(function(){deleted_id=parseInt($(this).attr("item_id")),$("#modal_confirm").modal("show")})}}),$(".btn_add_new_item").click(function(){$(".extent_package").remove(),$("#modal_add_edit .modal-title").html("Create new "+item_name),$("#modal_add_edit .txt_add_edit_item_name").val(""),$("#modal_add_edit .txt_add_edit_ios_package").val(""),$("#modal_add_edit .txt_add_edit_android_package").val(""),$("#modal_add_edit .btn_modal_save_new").show(),$("#modal_add_edit .btn_modal_save_update").hide(),$(".current_channels").html(" "),$("#modal_add_edit").modal("show")}),$("#page_datatable").on("order.dt",function(){}).on("search.dt",function(){}).on("page.dt",function(){}).dataTable(),$(".search_submit").click(function(){search_value=$(".search_input").val(),page_datatable.ajax.reload(null,!1)}),$(".search_clear").click(function(){search_value="",$(".search_input").val(""),page_datatable.ajax.reload(null,!1)}),$(".btn_confirm_yes").click(function(){_send_info.data={packageId:deleted_id},$.ajax({url:base_request_url+"/admin/package",type:"DELETE",data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(){$("#modal_confirm").modal("hide"),_send_info.data={},page_datatable.ajax.reload(),$("#modal_add_edit").modal("hide"),show_toast_notif("success","Successfully","Deleted: "+deleted_id,function(){})},error:function(a){show_toast_notif("error","Error info: ",a.responseText,function(){})}})}),$(".btn_modal_save_new").click(function(){var a="";$(".txt_add_edit_android_package").each(function(e,t){a+=$(t).val()+","});var e="";$(".txt_add_edit_ios_package").each(function(a,t){e+=$(t).val()+","}),_send_info.data={name:$(".txt_add_edit_item_name").val(),status:$(".select_status option:selected").val(),packageIOS:e,packageAndroid:a,channelsId:channel_arr,urlDownloadAndroid:$(".txt_add_edit_android_download").val(),urlDownloadiOS:$(".txt_add_edit_ios_download").val()},$.ajax({url:base_request_url+"/admin/package",type:"POST",data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(){$("#modal_add_edit").modal("hide"),page_datatable.ajax.reload(),show_toast_notif("success","Successfully","Item '"+$(".txt_add_edit_item_name").val()+"' is created",function(){})}})}),$(".btn_modal_save_update").click(function(){var a="";$(".txt_add_edit_android_package").each(function(e,t){a+=$(t).val()+","});var e="";$(".txt_add_edit_ios_package").each(function(a,t){e+=$(t).val()+","}),_send_info.data={id:editing_item,name:$(".txt_add_edit_item_name").val(),status:$(".select_status option:selected").val(),packageIOS:e,packageAndroid:a,channelsId:channel_arr,urlDownloadAndroid:$(".txt_add_edit_android_download").val(),urlDownloadiOS:$(".txt_add_edit_ios_download").val()},$.ajax({url:base_request_url+"/admin/package",type:"PUT",data:JSON.stringify(_send_info.data),contentType:"application/json",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","bearer "+_user_data.access_token)},success:function(){$("#modal_add_edit").modal("hide"),page_datatable.ajax.reload(),show_toast_notif("success","Successfully","Item '"+$(".txt_add_edit_item_name").val()+"' is updated",function(){})}})}),$(".select_status").change(function(){"active"==$(this).val()?$(".select_status button").css("background-color","#32c5d2"):"inactive"==$(this).val()&&$(".select_status button").css("background-color","red")}),$(".btn_add_more_android_package").click(function(){t("")}),$(".btn_add_more_ios_package").click(function(){n("")})};jQuery(document).ready(function(){Page_script.init(),load_page()});